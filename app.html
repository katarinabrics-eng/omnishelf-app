<!DOCTYPE html>
<!-- OmniShelf ‚Äì hlavn√≠ aplikace: Knihovna, Tr≈æi≈°tƒõ (NOVINKA, 2+1, Co prod√°v√°m), Vitus, Workshop, ≈†atn√≠k. V≈°echny cesty relativn√≠ (./) pro Vercel. -->
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="application-name" content="OmniShelf">
    <title>OmniShelf 2.0</title>
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#8DD311">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="apple-touch-icon" href="./assets/img/ikona_kartyknih.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./style.css?v=final_design">
    <link rel="stylesheet" href="./css/pricing.css">
    <link rel="stylesheet" href="./css/marketplace.css?v=1">
    <link rel="stylesheet" href="./css/messages.css?v=1">
</head>
<body>
    <div class="sidebar-overlay-backdrop" id="sidebarOverlayBackdrop" aria-hidden="true" role="button" tabindex="-1" title="Zav≈ô√≠t menu"></div>
    <script>
        (function () {
            var p = new URLSearchParams(window.location.search);
            if (p.get('mode') === 'kids') window.__omniModeKids = true;
            var mod = p.get('module');
            if (mod === 'vitus' || mod === 'library' || mod === 'marketplace') window.__omniOpenModule = mod;
        })();
    </script>
    <div class="dashboard">
        <div id="sidebar-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <button type="button" class="btn-sidebar-close-mobile" id="btnSidebarCloseMobile" aria-label="Zav≈ô√≠t menu" title="Zav≈ô√≠t"><span aria-hidden="true">√ó</span></button>
                <button type="button" class="btn-back-to-dashboard" id="btnBackToDashboard" style="display:none;"><span class="btn-back-arrow" style="color:#8DD311;">‚Üê</span><span class="btn-back-text">zpƒõt na OmniShelf</span></button>
                <button type="button" class="sidebar-logo" id="sidebarLogo" aria-label="Zpƒõt na Knihovnu">
                    <div class="sidebar-logo-icon">
                        <img src="./Ikony do aplikace _ 200px/Logo.png" alt="" class="sidebar-logo-img">
                    </div>
                    <div class="sidebar-logo-inner">
                        <div class="sidebar-logo-text" id="sidebarLogoText">OmniShelf AI</div>
                        <div class="sidebar-slogan" id="sidebarSlogan" data-i18n="slogan">V≈°e, co miluje≈°, na jedn√© chytr√© polici</div>
                    </div>
                </button>
            </div>
            <div class="sidebar-module-switcher" id="sidebarModuleSwitcher" aria-label="P≈ôepnout modul">
                <a href="./app.html" class="sidebar-module-btn sidebar-module-link active" data-omni-module="library" aria-pressed="true" title="Knihovna">
                    <span class="sidebar-module-icon" aria-hidden="true"><img src="./Ikony do aplikace _ 200px/01_small200px_4.png" alt=""></span>
                    <span class="sidebar-module-label">Knihovna</span>
                </a>
                <a href="./app.html?module=vitus" class="sidebar-module-btn sidebar-module-link" data-omni-module="vitus" aria-pressed="false" title="Vitus (Apatyka)">
                    <span class="sidebar-module-icon" aria-hidden="true"><img src="./Ikony do aplikace _ 200px/01_small200px_8.png" alt=""></span>
                    <span class="sidebar-module-label">Vitus</span>
                </a>
                <a href="./coming-soon.html?module=wardrobe" class="sidebar-module-btn sidebar-module-link" title="≈†atn√≠k ‚Äì ji≈æ brzy">
                    <span class="sidebar-module-icon" aria-hidden="true"><img src="./Ikony do aplikace _ 200px/01_small200px_13.png" alt=""></span>
                    <span class="sidebar-module-label">≈†atn√≠k</span>
                    <span class="sidebar-module-soon">Soon</span>
                </a>
                <a href="./coming-soon.html?module=workshop" class="sidebar-module-btn sidebar-module-link" title="Workshop ‚Äì ji≈æ brzy">
                    <span class="sidebar-module-icon" aria-hidden="true"><img src="./Ikony do aplikace _ 200px/01_small200px_14.png" alt=""></span>
                    <span class="sidebar-module-label">Workshop</span>
                    <span class="sidebar-module-soon">Soon</span>
                </a>
                <a href="./coming-soon.html?module=pantry" class="sidebar-module-btn sidebar-module-link" title="Pantry ‚Äì ji≈æ brzy">
                    <span class="sidebar-module-icon" aria-hidden="true"><img src="./Ikony do aplikace _ 200px/01_small200px_5.png" alt=""></span>
                    <span class="sidebar-module-label">Pantry</span>
                    <span class="sidebar-module-soon">Soon</span>
                </a>
            </div>
            <nav class="sidebar-nav">
                <div class="sidebar-menu sidebar-menu--library" id="sidebarMenuLibrary">
                <div class="sidebar-library-group sidebar-group-expandable" id="sidebarMainLibrary">
                    <button type="button" class="sidebar-nav-item sidebar-nav-toggle" id="sidebarMojeKnihovnaToggle" data-module="library" data-has-submenu="1" aria-expanded="true" aria-controls="librarySubmenu">Moje knihovna</button>
                    <div class="sidebar-submenu" id="librarySubmenu" role="group" aria-label="Moje knihovna">
                        <button type="button" class="sidebar-submenu-item" data-view="collection" data-i18n="myCollection">Tvoje sb√≠rka</button>
                        <button type="button" class="sidebar-submenu-item active" data-view="currentlyReading" data-i18n="currentlyReading">Rozeƒçteno</button>
                        <button type="button" class="sidebar-submenu-item" data-view="borrowed" data-i18n="borrowed">P≈Øjƒçil/a jsem</button>
                        <button type="button" class="sidebar-submenu-item" data-view="borrowedByMe" data-i18n="borrowedByMe">M√°m vyp≈Øjƒçeno</button>
                        <button type="button" class="sidebar-submenu-item" data-view="wishlist">Wishlist</button>
                        <button type="button" class="sidebar-submenu-item" data-view="forSale">Na prodej</button>
                        <button type="button" class="sidebar-submenu-item" data-view="favorites">Srdcovky</button>
                        <button type="button" class="sidebar-submenu-item" data-view="friendsHighlights" data-i18n="friendsHighlights">P≈ô√°tel√© doporuƒçuj√≠</button>
                    </div>
                </div>
                <button type="button" class="sidebar-back-to-library" id="btnSidebarBackToLibrary"><span class="sidebar-back-arrow">‚Üê</span> zpƒõt na hlavn√≠ n√°stƒõnku</button>
                <hr class="sidebar-divider">
                <div class="sidebar-library-group" id="sidebarChildrenLibrary">
                    <button type="button" class="sidebar-nav-item" data-module="childrenLibrary" id="btnChildrenLibraryToggle"><span class="sidebar-nav-icon sidebar-nav-icon-img"><img src="./Ikony do aplikace _ 200px/01_small200px_11.png" alt=""></span> OmniShelf Kids</button>
                </div>
                <hr class="sidebar-divider" data-adult-only>
                <div class="sidebar-library-group" id="sidebarPracovna" data-adult-only>
                    <button type="button" class="sidebar-nav-item" data-module="pracovna" id="btnPracovnaToggle"><span class="sidebar-nav-icon sidebar-nav-icon-img"><img src="./Ikony do aplikace _ 200px/01_small200px_1.png" alt=""></span> Pracovna (Studium)</button>
                </div>
                <hr class="sidebar-divider" data-adult-only>
                <button type="button" class="sidebar-nav-item" data-module="marketplace" id="btnMarketplace" title="Prodat duplicitu, koupit z Wishlistu"><span class="sidebar-nav-icon sidebar-nav-icon-img"><img src="./Ikony do aplikace _ 200px/01_small200px_12.png" alt=""></span> Tr≈æi≈°tƒõ</button>
                <button type="button" class="sidebar-nav-item" data-module="messages" id="btnMessages" title="Zpr√°vy"><span class="sidebar-nav-icon sidebar-nav-icon-img"><img src="./Ikony do aplikace _ 200px/01_small200px_7.png" alt=""></span> Zpr√°vy</button>
                <a href="./coming-soon.html?module=friends" class="sidebar-nav-item sidebar-coming-soon sidebar-nav-link" title="P≈ô√°tel√© ‚Äì ji≈æ brzy">P≈ô√°tel√© <span class="sidebar-badge-coming">Coming Soon</span></a>
                <hr class="sidebar-divider" data-adult-only>
                <button type="button" class="sidebar-nav-item sidebar-nav-admin-only" data-module="statistics" data-i18n="moduleStatistics" data-adult-only>Statistiky</button>
                <div class="sidebar-rodina-wrap" id="sidebarRodinaWrap" data-adult-only>
                    <hr class="sidebar-rodina-divider">
                    <div class="sidebar-rodina-title">RODINA</div>
                    <div id="sidebarRodinaList" class="sidebar-rodina-list"></div>
                </div>
                </div>

                <div class="sidebar-menu sidebar-menu--vitus" id="sidebarMenuVitus" hidden>
                    <div class="sidebar-vitus-title">Vitus (Apatyka)</div>
                    <button type="button" class="vitus-nav-item active" data-vitus-view="meds">L√©ky</button>
                    <button type="button" class="vitus-nav-item" data-vitus-view="dose">D√°vkov√°n√≠</button>
                    <button type="button" class="vitus-nav-item" data-vitus-view="herbalist">B√°ba Ko≈ôen√°≈ôka</button>
                </div>
                <button type="button" class="sidebar-nav-item sidebar-nav-settings" id="btnOpenSettings" data-open-modal="settings">Nastaven√≠<span class="settings-pending-dot" id="settingsPendingDot" aria-hidden="true"></span></button>
                <div class="sidebar-export" data-adult-only>
                    <div class="sidebar-export-title">Export</div>
                    <div class="sidebar-export-btns">
                        <button type="button" class="btn-export" id="btnExportPdf">St√°hnout PDF</button>
                        <button type="button" class="btn-export" id="btnExportCsv">St√°hnout CSV</button>
                    </div>
                </div>
            </nav>
            <div class="sidebar-stats" id="sidebarStats">Celkem: 0 polo≈æek</div>
        </aside>
        </div>
        <main class="main-content">
            <!-- Glob√°ln√≠ varovn√Ω pruh: zobraz√≠ se, pokud existuje kniha s datem vr√°cen√≠ <= dnes -->
            <div class="overdue-banner" id="overdueBanner" style="display: none;" role="alert">
                <span class="overdue-banner-text" id="overdueBannerText">Pozor, jedna kn√≠≈æka se n√°m nƒõkde zapomnƒõla! Nƒõkdo ji m√° u sebe u≈æ moc dlouho‚Ä¶</span>
                <button type="button" class="overdue-banner-btn" id="overdueBannerBtn">Poslat jemn√© popostrƒçen√≠</button>
            </div>
            <!-- 1. MODULES/MainHeader.html ‚Äì horn√≠ li≈°ta: lupa a ikona vpravo (nadpis ‚ÄûMoje knihovna‚Äú je v lev√© kartƒõ) -->
            <div class="top-bar main-top-bar has-trial" id="topBar">
                <div id="trialWarningBanner" class="trial-banner trial-banner-admin-visible" role="alert">
                    <span class="trial-banner-icon" aria-hidden="true"></span>
                    <p class="trial-banner-text" id="trialBannerText">Zku≈°ebn√≠ verze ‚Äì aktivujte ƒçlenstv√≠ pro pln√Ω p≈ô√≠stup.</p>
                    <button type="button" class="trial-banner-cta" id="trialBannerActivate">Aktivovat ƒçlenstv√≠</button>
                </div>
                <button type="button" class="btn-mobile-menu-toggle" id="btnMobileMenuToggle" aria-label="Otev≈ô√≠t menu" aria-expanded="false"><span class="hamburger-icon" aria-hidden="true">‚ò∞</span></button>
                <div class="header-actions header-actions-top">
                    <div class="global-search-wrap">
                        <button type="button" class="btn-global-search-toggle" id="btnGlobalSearchToggle" aria-label="Hledat">üîç</button>
                        <div class="global-search-bar" id="globalSearchBar">
                            <input type="text" id="globalSearchInput" data-i18n-placeholder="globalSearchPlaceholder" placeholder="Najdi cokoliv ve sb√≠rk√°ch‚Ä¶" autocomplete="off" />
                            <button type="button" class="btn-global-search-close" id="btnGlobalSearchClose" aria-label="Zav≈ô√≠t">√ó</button>
                        </div>
                        <div class="global-search-results" id="globalSearchResults" aria-hidden="true"></div>
                    </div>
                    <div class="library-global-sort-wrap">
                        <select id="libraryGlobalSortSelect" class="library-global-sort-select" aria-label="Se≈ôadit knihy">
                            <option value="">Se≈ôadit‚Ä¶</option>
                            <option value="author">Autor A‚ÄìZ</option>
                            <option value="author_desc">Autor Z‚ÄìA</option>
                            <option value="genre">≈Ω√°nr</option>
                            <option value="status">Stav</option>
                            <option value="privacy">Sd√≠len√≠</option>
                        </select>
                        <span class="library-filter-summary" id="libraryFilterSummaryTop" aria-live="polite"></span>
                    </div>
                    <div class="profile-switcher-wrap">
                        <button type="button" class="btn-profile-switcher" id="btnProfileSwitcher" aria-label="Profil" title="Profil"><span class="profile-initials" id="profileInitials">J√°</span></button>
                        <div class="profile-dropdown" id="profileDropdown" style="display:none;">
                            <button type="button" class="profile-dropdown-item profile-dropdown-settings" id="profileDropdownSettings">Nastaven√≠ √∫ƒçtu</button>
                            <div class="profile-dropdown-list" id="profileDropdownList"></div>
                            <button type="button" class="profile-add-member" id="btnAddFamilyMember" data-i18n="addFamilyMember">+ P≈ôidat ƒçlena rodiny</button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Vitus (Apatyka) ‚Äì samostatn√Ω dashboard (placeholder) -->
            <section class="vitus-section" id="vitusSection" style="display:none;" aria-label="Vitus ‚Äì Apatyka">
                <div class="vitus-hero">
                    <div class="vitus-hero-badge">üåø Vitus</div>
                    <h2 class="vitus-hero-title">Apatyka</h2>
                    <p class="vitus-hero-sub" id="vitusWelcomeText">V√≠tejte v Apatyce. B√°ba Ko≈ôen√°≈ôka p≈ôipravuje va≈°e bylinky a l√©ky.</p>
                </div>
                <div class="vitus-panel">
                    <div class="vitus-panel-header">
                        <h3 class="vitus-panel-title" id="vitusViewTitle">L√©ky</h3>
                        <span class="vitus-panel-hint">Jste v nov√©m modulu ‚Äì odli≈°n√° paleta je z√°mƒõr.</span>
                    </div>
                    <div class="vitus-panel-body" id="vitusViewBody"></div>
                </div>
            </section>
            <!-- Statistiky (pouze dospƒõl√Ω re≈æim) -->
            <section class="statistics-section" id="statisticsSection" data-adult-only style="display:none;">
                <h2 class="statistics-title">Statistiky</h2>
                <div class="statistics-casostroj" id="statisticsCasostroj">
                    <label class="statistics-casostroj-label">‚è±Ô∏è ƒåasostroj ‚Äì filtr podle data p≈ôid√°n√≠</label>
                    <div class="statistics-casostroj-row">
                        <input type="date" id="statisticsDateFrom" class="statistics-date-input" />
                        <span class="statistics-date-sep">‚Äì</span>
                        <input type="date" id="statisticsDateTo" class="statistics-date-input" />
                        <button type="button" class="btn-casostroj-reset" id="btnCasostrojReset">Zru≈°it filtr</button>
                    </div>
                </div>

                <div class="statistics-filter-accordion" id="statisticsFilterAccordion">
                    <button type="button" class="statistics-filter-toggle" id="statisticsFilterToggle" aria-expanded="false">
                        <span>Filtrovat pole</span>
                        <span class="statistics-filter-chevron">‚ñº</span>
                    </button>
                    <div class="statistics-filter-body" id="statisticsFilterBody" hidden>
                        <div class="statistics-filter-row">
                            <label class="statistics-filter-label" for="statisticsFilterField">Filtrovat podle</label>
                            <select id="statisticsFilterField" class="statistics-filter-select">
                                <option value="">‚Äî bez filtru ‚Äî</option>
                                <option value="section">Sekce</option>
                                <option value="shelf">Poliƒçka v knihovnƒõ</option>
                                <option value="author">Autor</option>
                                <option value="collection">Kolekce</option>
                                <option value="privacy">Soukrom√≠ sb√≠rky</option>
                                <option value="favorites">Srdcovky</option>
                            </select>
                            <select id="statisticsFilterValue" class="statistics-filter-select" disabled>
                                <option value="">‚Äî vyberte hodnotu ‚Äî</option>
                            </select>
                            <div class="statistics-filter-actions">
                                <button type="button" class="btn-stat-filter btn-stat-filter--apply" id="statisticsApplyFilter" disabled>Pou≈æ√≠t filtr</button>
                                <button type="button" class="btn-stat-filter" id="statisticsClearFilter" style="display:none;">Zru≈°it filtr</button>
                            </div>
                        </div>
                        <div class="statistics-filter-hint">Tip: nejd≈ô√≠v vyberte typ filtru a potom hodnotu. Podle toho se uprav√≠ karty i exportn√≠ tabulka.</div>
                    </div>
                </div>

                <div class="statistics-cards" id="statisticsCards"></div>
                <div class="statistics-loans" id="statisticsLoans"></div>
                <div class="statistics-rooms" id="statisticsRooms"></div>

                <div class="statistics-export-table-wrap" id="statisticsExportTableWrap">
                    <h3 class="statistics-subtitle">Exportn√≠ tabulka (podle filtru)</h3>
                    <div class="statistics-export-table" id="statisticsExportTable" aria-live="polite"></div>
                    <div class="statistics-export-actions">
                        <button type="button" class="btn-export btn-export--inline" id="btnExportPdfStats">St√°hnout PDF</button>
                        <button type="button" class="btn-export btn-export--inline" id="btnExportCsvStats">St√°hnout CSV</button>
                    </div>
                </div>
            </section>
            <!-- Tr≈æi≈°tƒõ ‚Äì HTML vlo≈æeno inline; na Vercel se v≈°e naƒç√≠t√° relativn√≠mi cestami (./) -->
            <div class="marketplace-section omni-marketplace" id="marketplaceSection" style="display:none;" aria-label="Tr≈æi≈°tƒõ"></div>
            <template id="marketplaceTemplate">
                <p class="marketplace-design-banner" aria-hidden="true">Tr≈æi≈°tƒõ</p>
                <div class="marketplace-header">
                    <h1 class="marketplace-title marketplace-title--welcome">V√≠tejte v Tr≈æi≈°ti! nakupujte, prod√°vejte, sd√≠lejte recenze, objevujte!</h1>
                    <div class="marketplace-global-search-wrap">
                        <label for="marketplaceGlobalSearch" class="sr-only">Hledat knihu v Tr≈æi≈°ti</label>
                        <input type="search" id="marketplaceGlobalSearch" class="marketplace-global-search" placeholder="Hledat knihu v Tr≈æi≈°ti" autocomplete="off" />
                        <span class="marketplace-global-search-icon" aria-hidden="true">&#128269;</span>
                    </div>
                </div>
                <nav class="marketplace-categories-bar" role="tablist" aria-label="Kategorie v Tr≈æi≈°ti">
                    <button type="button" class="marketplace-category-btn active" data-category="books" role="tab" aria-selected="true">
                        <span class="marketplace-category-icon"><img src="./Ikony do aplikace _ 200px/01_small200px_4.png" alt="" width="22" height="22"></span>
                        <span>Knihy</span>
                    </button>
                    <button type="button" class="marketplace-category-btn" data-category="tools" role="tab" aria-selected="false"><span>N√°≈ôad√≠</span></button>
                    <button type="button" class="marketplace-category-btn" data-category="clothing" role="tab" aria-selected="false"><span>Obleƒçen√≠</span></button>
                </nav>
                <div class="marketplace-accordion collapsed" id="marketplaceNaProdejAccordion">
                    <button type="button" class="marketplace-accordion-toggle" id="marketplaceNaProdejToggle" aria-expanded="false">
                        <span class="marketplace-accordion-title">Na prodej</span>
                        <span class="marketplace-accordion-chevron">&#9660;</span>
                    </button>
                    <div class="marketplace-accordion-body" id="marketplaceNaProdejBody" hidden>
                        <label for="marketplaceSellSearchInput">Vyhledat knihu ze sb√≠rky</label>
                        <input type="text" id="marketplaceSellSearchInput" class="marketplace-sell-search-input" placeholder="N√°zev nebo autor‚Ä¶" />
                        <button type="button" class="marketplace-modal-open-btn" id="btnMarketplaceOpenModalFromSection">Oznaƒçit knihu na prodej</button>
                    </div>
                </div>
                <!-- ≈ò√°dek 1: NOVINKY V TR≈ΩI≈†TI (zelen√© akcenty) -->
                <section class="marketplace-carousel-row marketplace-carousel-row--novinky" aria-labelledby="marketplaceNovinkyHeading">
                    <div class="marketplace-carousel-row-header">
                        <span class="marketplace-carousel-row-header-bar" aria-hidden="true"></span>
                        <h2 class="marketplace-carousel-title" id="marketplaceNovinkyHeading">Novinky v Tr≈æi≈°ti</h2>
                    </div>
                    <div class="marketplace-carousel-scroll">
                        <div class="omni-marketplace-cards marketplace-carousel-track" id="marketplaceNovinkyCarousel" role="list">
                            <article class="marketplace-card marketplace-card--novinka" role="listitem" tabindex="0" data-marketplace-card data-marketplace-status="na-prodej">
                                <div class="marketplace-card__cover-wrap">
                                    <span class="marketplace-card__status-label marketplace-card__status-label--left marketplace-card__status-label--novinka">NOVINKA</span>
                                    <span class="marketplace-card__cover-fallback">&#128218;</span>
                                </div>
                                <div class="marketplace-card__body">
                                    <h3 class="marketplace-card__title">Jedna Noha Hop A Druh√° Na Cestƒõ</h3>
                                    <p class="marketplace-card__author">Terry Pratchett</p>
                                    <p class="marketplace-card__seller">Prod√°v√°: Knihkupectv√≠ XY</p>
                                    <div class="user-bubble">Tuhle knihu jsem ƒçetla 3x, je bo≈æ√≠.</div>
                                    <button type="button" class="marketplace-card__msg-owner" data-action="message-owner">Napsat majiteli</button>
                                </div>
                            </article>
                            <article class="marketplace-card marketplace-card--novinka" role="listitem" tabindex="0" data-marketplace-card data-marketplace-status="k-zapujceni">
                                <div class="marketplace-card__cover-wrap">
                                    <span class="marketplace-card__status-label marketplace-card__status-label--left marketplace-card__status-label--k-zapujceni">K zap≈Øjƒçen√≠</span>
                                    <span class="marketplace-card__cover-fallback">&#128218;</span>
                                </div>
                                <div class="marketplace-card__body">
                                    <h3 class="marketplace-card__title">Hobit</h3>
                                    <p class="marketplace-card__author">J. R. R. Tolkien</p>
                                    <p class="marketplace-card__seller">Prod√°v√°: Sousedka Jana</p>
                                    <div class="user-bubble">Doporuƒçuji, skvƒõl√Ω stav.</div>
                                    <button type="button" class="marketplace-card__msg-owner" data-action="message-owner">Napsat majiteli</button>
                                </div>
                            </article>
                        </div>
                    </div>
                </section>
                <!-- ≈ò√°dek 2: BESTSELLER (oran≈æovo-ƒçerven√© akcenty) -->
                <section class="marketplace-carousel-row marketplace-carousel-row--bestseller" aria-labelledby="marketplaceBestsellerHeading">
                    <div class="marketplace-carousel-row-header">
                        <span class="marketplace-carousel-row-header-bar" aria-hidden="true"></span>
                        <h2 class="marketplace-carousel-title" id="marketplaceBestsellerHeading">Bestseller</h2>
                    </div>
                    <div class="marketplace-carousel-scroll">
                        <div class="omni-marketplace-cards marketplace-carousel-track" id="marketplaceBestsellerCarousel" role="list">
                            <article class="marketplace-card marketplace-card--bestseller" role="listitem" tabindex="0" data-marketplace-card>
                                <div class="marketplace-card__cover-wrap">
                                    <span class="marketplace-card__status-label marketplace-card__status-label--left marketplace-card__status-label--bestseller">2+1</span>
                                    <span class="marketplace-card__cover-fallback">&#128218;</span>
                                </div>
                                <div class="marketplace-card__body">
                                    <h3 class="marketplace-card__title">Bestseller ‚Äì brzy v√≠ce</h3>
                                    <p class="marketplace-card__author">‚Äî</p>
                                    <p class="marketplace-card__seller">Prod√°v√°: ‚Äî</p>
                                    <div class="user-bubble">Tipy na bestsellery p≈ôipravujeme.</div>
                                    <button type="button" class="marketplace-card__msg-owner" data-action="message-owner">Napsat majiteli</button>
                                </div>
                            </article>
                        </div>
                    </div>
                </section>
                <!-- ≈ò√°dek 3: CO PROD√ÅV√ÅM (moje police ‚Äì barevn√Ω pruh v z√°hlav√≠) -->
                <section class="marketplace-carousel-row marketplace-carousel-row--co-prodavam marketplace-window marketplace-my-shelf-section" id="marketplaceMyShelfSection" aria-labelledby="marketplaceMyShelfHeading">
                    <div class="marketplace-carousel-row-header">
                        <span class="marketplace-carousel-row-header-bar" aria-hidden="true"></span>
                        <h2 class="marketplace-carousel-title" id="marketplaceMyShelfHeading">Co prod√°v√°m</h2>
                    </div>
                    <p class="marketplace-my-shelf-desc">Karty z rubriky ‚ÄûNa prodej‚Äú v Moje knihovna. Oznaƒç√≠te-li knihu jako Na prodej, objev√≠ se zde.</p>
                    <div class="marketplace-carousel-scroll">
                        <div class="omni-marketplace-cards marketplace-carousel-track marketplace-my-shelf-grid" id="marketplaceMyShelfContainer" role="list"></div>
                    </div>
                </section>
            </template>
            <!-- Zpr√°vy (Messenger / Slack styl) ‚Äì seznam kontakt≈Ø a n√°hled konverzace -->
            <section class="messages-section" id="messagesSection" style="display:none;" aria-label="Zpr√°vy">
                <div class="messages-header">
                    <h1 class="messages-title">Zpr√°vy</h1>
                    <p class="messages-subtitle">Konverzace s majiteli knih a p≈ô√°teli z OmniShelf</p>
                </div>
                <div class="messages-list" id="messagesList" role="list">
                    <article class="messages-contact" data-contact-id="1" role="listitem" tabindex="0">
                        <div class="messages-contact-avatar"><img src="./Ikony do aplikace _ 200px/01_small200px_1.png" alt="" aria-hidden="true"></div>
                        <div class="messages-contact-body">
                            <span class="messages-contact-name">Sousedka Jana</span>
                            <span class="messages-contact-preview">M≈Ø≈æu ji vr√°tit p≈ô√≠≈°t√≠ t√Ωden.</span>
                        </div>
                    </article>
                    <article class="messages-contact" data-contact-id="2" role="listitem" tabindex="0">
                        <div class="messages-contact-avatar"><img src="./Ikony do aplikace _ 200px/01_small200px_2.png" alt="" aria-hidden="true"></div>
                        <div class="messages-contact-body">
                            <span class="messages-contact-name">Knihomol Petr</span>
                            <span class="messages-contact-preview">Ta Pratchettovka je skvƒõl√°, d√≠ky!</span>
                        </div>
                    </article>
                </div>
            </section>
            <!-- MODULES/Reading.html ‚Äì sekce Rozeƒçteno (vlo≈æen√Ω obsah, bez z√°vislosti na fetch) -->
            <div id="readingViewWrap" class="reading-view-container" style="display:none;" aria-hidden="true">
                <section class="reading-view-wrap reading-panel" id="readingViewSection" aria-label="Rozeƒçteno">
                    <!-- 1. Horn√≠ ≈ôada: vlevo dotaz + n√°lada, vpravo Voln√Ω dotaz -->
                    <div class="reading-top-row">
                        <div class="reading-top-left">
                            <h2 class="reading-today-title">Co m√°m rozeƒçten√©</h2>
                            <p class="reading-today-desc">Ahoj, chce≈° doporuƒçen√≠, co si p≈ôeƒç√≠st pr√°vƒõ teƒè podle sv√© n√°lady?</p>
                            <div class="reading-bubbles" role="group" aria-label="Rychl√Ω v√Ωbƒõr n√°lady">
                                <button type="button" class="reading-bubble" data-mood="cool" aria-label="Odpoƒçinkov√©">üòé</button>
                                <button type="button" class="reading-bubble" data-mood="zen" aria-label="Klid">üßò‚Äç‚ôÇÔ∏è</button>
                                <button type="button" class="reading-bubble" data-mood="mind" aria-label="Soust≈ôedƒõn√≠">üß†</button>
                                <button type="button" class="reading-bubble" data-mood="book" aria-label="ƒåten√≠">üìö</button>
                                <button type="button" class="reading-bubble" data-mood="star" aria-label="Objev">üåü</button>
                                <button type="button" class="reading-bubble" data-mood="drama" aria-label="P≈ô√≠bƒõh">üé≠</button>
                            </div>
                        </div>
                        <div class="reading-top-right">
                            <label for="readingAiQueryInput" class="reading-ai-label">Voln√Ω dotaz</label>
                            <input type="text" id="readingAiQueryInput" class="reading-ai-input" placeholder="Nap≈ô. ‚ÄûNud√≠m se, chci nƒõco, co mƒõ zabav√≠‚Ä¶‚Äú" autocomplete="off" />
                            <span class="reading-ai-input-hint">Odeslat: Enter</span>
                        </div>
                    </div>
                    <!-- 2. St≈ôedn√≠ ≈ôada: v√Ωbƒõr podle ≈æ√°nru / n√°lady -->
                    <p class="reading-middle-intro">Nebo si vyber podle ≈æ√°nru, nebo jen na co m√°≈° chu≈•</p>
                    <div class="reading-mood-bar-wrap">
                        <span class="reading-mood-label">Na co m√°≈° dnes chu≈•?</span>
                        <div class="reading-mood-bar">
                            <button type="button" class="reading-mood-btn" data-mood="adventure">üöÄ Dobrodru≈æstv√≠</button>
                            <button type="button" class="reading-mood-btn" data-mood="melancholy">üåô Melancholie</button>
                            <button type="button" class="reading-mood-btn" data-mood="uplift">üî• Povzbuzen√≠</button>
                            <button type="button" class="reading-mood-btn" data-mood="mystery">üçÄ Z√°hada</button>
                        </div>
                    </div>
                    <div class="reading-genre-wrap">
                        <span class="reading-genre-label">≈Ω√°nrov√° doporuƒçen√≠</span>
                        <div class="reading-genre-bar">
                            <button type="button" class="reading-genre-btn" data-genre="detektivka">üîç Detektivky</button>
                            <button type="button" class="reading-genre-btn" data-genre="scifi">üöÄ Sci-fi</button>
                            <button type="button" class="reading-genre-btn" data-genre="romantika">üíï Romantika</button>
                            <button type="button" class="reading-genre-btn" data-genre="fantasy">‚öîÔ∏è Fantasy</button>
                            <button type="button" class="reading-genre-btn" data-genre="thriller">üé¨ Thriller</button>
                        </div>
                    </div>
                    <!-- 3. Okno pro odpovƒõƒè AI -->
                    <div class="reading-ai-response" id="readingAiResponse" aria-live="polite">
                        <p class="reading-ai-response-text" id="readingAiResponseText">zde bude odpovƒõƒè od AI</p>
                    </div>
                    <!-- 3b. Karta doporuƒçen√© knihy (zobraz√≠ se po AI doporuƒçen√≠) -->
                    <div class="reading-recommended-card-wrap" id="readingRecommendedCardWrap" aria-live="polite"></div>
                    <!-- 4. Spodn√≠ akce -->
                    <div class="reading-bottom-bar">
                        <button type="button" class="reading-find-book-btn" id="readingSearchBtn">Zkus mi doporuƒçit nƒõco jin√©ho</button>
                    </div>
                </section>
            </div>
            <!-- Moduly knihovny: Texty | Upload soubor≈Ø -->
            <div class="library-modules-wrap" id="libraryModulesWrap">
                <nav class="library-module-tabs" role="tablist" aria-label="Zp≈Øsob p≈ôid√°n√≠ do knihovny">
                    <button type="button" class="library-module-tab active" role="tab" id="libraryTabTexty" aria-selected="true" aria-controls="libraryModuleTexty" data-library-module="texty">Texty</button>
                    <button type="button" class="library-module-tab" role="tab" id="libraryTabUpload" aria-selected="false" aria-controls="libraryModuleUpload" data-library-module="upload">Upload soubor≈Ø</button>
                </nav>
                <div class="library-modules-status-bar" id="libraryModulesStatusBar" aria-live="polite">
                    <span class="library-modules-status-text" id="libraryModulesStatusText">Panel nahr√°v√°n√≠ je zav≈ôen√Ω</span>
                    <button type="button" class="library-modules-open-btn" id="btnOpenLibraryModules">Otev≈ô√≠t nahr√°v√°n√≠</button>
                    <button type="button" class="library-modules-close-btn" id="btnCloseLibraryModules" aria-label="Zav≈ô√≠t panel nahr√°v√°n√≠" title="Zav≈ô√≠t" hidden>√ó</button>
                </div>
                <div id="libraryModulesPanelsWrap" hidden>
                <!-- Modul Texty: ruƒçn√≠ p≈ôid√°v√°n√≠ knih -->
                <section class="library-module library-module-texty" id="libraryModuleTexty" role="tabpanel" aria-labelledby="libraryTabTexty">
            <form class="text-quick-add-form" id="textQuickAddForm">
                <div class="text-quick-add-row">
                    <label for="textQuickTitle" class="upload-card-label upload-card-label-inline">N√°zev</label>
                    <input type="text" id="textQuickTitle" class="shelf-input upload-inline-input" placeholder="N√°zev knihy" />
                </div>
                <div class="text-quick-add-row">
                    <label for="textQuickAuthor" class="upload-card-label upload-card-label-inline">Autor</label>
                    <input type="text" id="textQuickAuthor" class="shelf-input upload-inline-input" placeholder="Autor" />
                </div>
                <div class="text-quick-add-row">
                    <label for="textQuickGenre" class="upload-card-label upload-card-label-inline">≈Ω√°nr</label>
                    <input type="text" id="textQuickGenre" class="shelf-input upload-inline-input" placeholder="nap≈ô. Fantasy" />
                </div>
                <div class="text-quick-add-row text-quick-add-row--cover">
                    <label for="textQuickCover" class="upload-card-label upload-card-label-inline">Ob√°lka</label>
                    <input type="file" id="textQuickCover" accept="image/*" />
                    <div class="text-quick-cover-preview" id="textQuickCoverPreview" aria-hidden="true"></div>
                </div>
                <button type="submit" class="text-quick-add-submit" id="textQuickAddSubmit">P≈ôidat do knihovny</button>
            </form>
            <!-- 3. MODULES/LibraryManualAdd.html -->
            <div class="manual-add-toggle-row">
                <button type="button" class="btn-manual-add-toggle" id="btnToggleManualAdd">+ P≈ôidat knihu ruƒçnƒõ</button>
            </div>
            <div class="manual-add-panel" id="manualAddPanel" hidden>
            <form class="manual-add-form" id="manualAddForm">
                <div class="manual-add-form-title" data-i18n="addBookManually">P≈ôidat knihu ruƒçnƒõ</div>
                <div class="form-row form-row-five">
                    <div>
                        <label for="manualTitle" data-i18n="title">N√°zev</label>
                        <input type="text" id="manualTitle" data-i18n-placeholder="placeholderTitle" placeholder="N√°zev knihy" />
                    </div>
                    <div>
                        <label for="manualAuthor" data-i18n="author">Autor</label>
                        <input type="text" id="manualAuthor" data-i18n-placeholder="placeholderAuthor" placeholder="Jm√©no autora" />
                    </div>
                    <div>
                        <label for="manualLocation" data-i18n="location">Um√≠stƒõn√≠</label>
                        <input type="text" id="manualLocation" data-i18n-placeholder="placeholderShelf" placeholder="nap≈ô. Ob√Ωv√°k - horn√≠" />
                    </div>
                    <div>
                        <label for="manualPosition" data-i18n="position">Pozice na polici</label>
                        <input type="text" id="manualPosition" data-i18n-placeholder="placeholderPosition" placeholder="nap≈ô. vlevo, uprost≈ôed" />
                    </div>
                    <div>
                        <label for="manualEstimatedValue" data-i18n="estimatedValue">Odhadovan√° hodnota</label>
                        <input type="text" id="manualEstimatedValue" data-i18n-placeholder="estimatedValuePlaceholder" placeholder="nap≈ô. 200 Kƒç" />
                    </div>
                    <div>
                        <label for="manualOwner" data-i18n="owner">Vlastn√≠k</label>
                        <select id="manualOwner" class="add-item-modal-select"></select>
                    </div>
                </div>
                <div class="form-row form-row-isbn" style="margin-top:12px;display:flex;flex-wrap:wrap;align-items:flex-end;gap:16px;">
                    <div style="min-width:160px;max-width:200px;">
                        <label for="manualIsbn" data-i18n="isbnEan">ISBN/EAN</label>
                        <input type="text" id="manualIsbn" data-i18n-placeholder="placeholderIsbn" placeholder="nap≈ô. 978-80-123-4567-8" inputmode="numeric" />
                    </div>
                    <div style="display:flex;gap:12px;align-items:flex-end;">
                        <button type="submit" class="btn-add-manually" data-i18n="addManually">P≈ôidat ruƒçnƒõ</button>
                        <button type="button" class="btn-add-wishlist" id="btnAddWishlist">+ P≈ôidat do wishlistu</button>
                    </div>
                </div>
            </form>
            </div>
                </section>
                <!-- Modul Upload soubor≈Ø: nahr√°n√≠ fotek knihovny -->
                <section class="library-module library-module-upload" id="libraryModuleUpload" role="tabpanel" aria-labelledby="libraryTabUpload" hidden>
            <div class="upload-card library-card upload-card-wide" id="uploadCard">
                <p class="upload-target-hint" id="uploadTargetHint" aria-live="polite">Knihy se p≈ôidaj√≠ do: <strong id="uploadTargetCategory">Tvoje sb√≠rka</strong></p>
                <div class="upload-inline-row">
                    <label for="shelfName" class="upload-card-label upload-card-label-inline">Aktu√°lnƒõ skenuji poliƒçku</label>
                    <input type="text" id="shelfName" class="shelf-input upload-inline-input" data-i18n-placeholder="placeholderShelf" placeholder="nap≈ô. Ob√Ωv√°k - horn√≠" />
                </div>

                <div class="upload-batch-fields upload-batch-fields-compact" id="uploadBatchFields">
                    <div class="upload-batch-field">
                        <label for="batchShelfPosition" class="upload-card-label upload-card-label-inline">Um√≠stƒõn√≠ v polici</label>
                        <input type="text" id="batchShelfPosition" class="shelf-input upload-batch-input" placeholder="nap≈ô. ≈ôada 2, sloupec B (AI dopln√≠)" />
                    </div>
                    <div class="upload-batch-field">
                        <label for="batchCollection" class="upload-card-label upload-card-label-inline">Kolekce</label>
                        <input type="text" id="batchCollection" class="shelf-input upload-batch-input" placeholder="nap≈ô. Harry Potter / Discworld‚Ä¶" />
                    </div>
                </div>

                <div class="upload-scans-grid" id="uploadScansGrid">
                    <div class="upload-scan-col">
                        <div class="upload-subtitle">Skenovat polici</div>
                        <div class="upload-area upload-area-dashed-green upload-area-compact upload-drop-zone" id="uploadArea">
                            <button type="button" class="upload-tips-inzone-btn" data-open-tips="1">üí° Tipy a video n√°vod</button>
                            <div class="upload-icon upload-icon-camera">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/></svg>
                            </div>
                            <div class="upload-text" id="uploadTextEl">Nahrajte 1 fotku poliƒçky (ƒçiteln√© h≈ôbety)</div>
                            <input type="file" id="fileInput" accept="image/*" />
                        </div>
                        <div id="imagePreview"></div>
                        <div id="fileInfo"></div>
                        <div class="analyze-row">
                            <button class="analyze-button" id="analyzeButton" disabled>Skenovat polici</button>
                            <div class="analyze-loading-bar" id="analyzeLoadingBar" aria-hidden="true" aria-live="polite">Analyzuji‚Ä¶</div>
                        </div>
                        <div class="message error" id="errorMessage"></div>
                        <div class="message success" id="successMessage"></div>
                    </div>

                    <div class="upload-scan-col">
                        <div class="upload-subtitle">Skenovat detailnƒõ (1 kniha)</div>
                        <div class="upload-area upload-area-dashed-green upload-area-compact upload-drop-zone" id="uploadAreaDetail">
                            <button type="button" class="upload-tips-inzone-btn" data-open-tips="1">üí° Tipy a video n√°vod</button>
                            <div class="upload-icon upload-icon-camera">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/></svg>
                            </div>
                            <div class="upload-text">Nahrajte v√≠ce fotek jedn√© knihy (ob√°lka + ISBN)</div>
                            <input type="file" id="fileInputDetail" accept="image/*" multiple />
                        </div>
                        <div id="imagePreviewDetail" class="image-preview-multi"></div>
                        <div id="fileInfoDetail"></div>
                        <div class="analyze-row">
                            <button class="analyze-button" id="analyzeButtonDetail" disabled>Skenovat detailnƒõ</button>
                            <div class="analyze-loading-bar" id="analyzeLoadingBarDetail" aria-hidden="true" aria-live="polite">Analyzuji‚Ä¶</div>
                        </div>
                        <div class="message error" id="errorMessageDetail"></div>
                        <div class="message success" id="successMessageDetail"></div>
                    </div>
                </div>

                <!-- Tipy + video: kompaktn√≠ modal (otev√≠r√° se tlaƒç√≠tkem v drop z√≥nƒõ) -->
                <div class="upload-tips-modal-overlay" id="uploadTipsModalOverlay" hidden role="dialog" aria-modal="true" aria-label="Tipy a video n√°vod">
                    <div class="upload-tips-modal">
                        <div class="upload-tips-modal-top">
                            <div class="upload-tips-modal-title">üí° Tipy a video n√°vod</div>
                            <button type="button" class="upload-tips-modal-close" id="uploadTipsModalClose" aria-label="Zav≈ô√≠t">√ó</button>
                        </div>
                        <div class="upload-tips-modal-body">
                            <p><strong>Bod 1:</strong> Hromadn√© focen√≠ (Police): Fo≈•te tak, aby byl jasnƒõ vidƒõt titul a autor. Pou≈æ√≠vejte rozpt√Ωlen√© svƒõtlo, ne p≈ô√≠m√© (odlesky znemo≈æ≈àuj√≠ AI identifikaci).</p>
                            <p><strong>Bod 2:</strong> Solit√©rn√≠ focen√≠: U jedn√© knihy m≈Ø≈æete nahr√°t v√≠ce fotek (ob√°lka + ISBN k√≥d). AI data spoj√≠.</p>
                            <p><strong>Varov√°n√≠:</strong> Technick√° kvalita je kl√≠ƒçov√° ‚Äì ≈æ√°dn√© rozmazan√© fotky.</p>
                            <a href="#" class="tips-card-video-btn tips-card-video-btn-compact" id="collectionIntroVideoLink">üé• Pustit video</a>
                        </div>
                    </div>
                </div>
            </div>
                </section>
                </div>
            </div>
            <!-- Pracovn√≠ plocha ‚ÄûTento sken‚Äú ‚Äì hned pod skenem police, nad Moje knihovna -->
            <div id="resultsSectionWrap" style="display: none;">
            <hr class="section-divider" />
            <div class="results-section this-scan-accordion collapsed" id="resultsSection">
                <div class="this-scan-header" id="thisScanHeader">
                    <h2 class="results-title this-scan-title" data-i18n="thisScan">Tento sken</h2>
                    <div class="this-scan-header-actions">
                        <button type="button" class="btn-approve-workspace" id="btnApproveWorkspace">Schv√°lit a p≈ôidat do knihovny</button>
                        <button type="button" class="btn-clear-workspace" id="btnClearWorkspace" data-i18n="clearWorkspace">Vymazat pracovn√≠ plochu</button>
                        <button type="button" class="this-scan-toggle" id="thisScanToggle" aria-label="Rozbalit / Sbalit">
                            <svg class="chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
                        </button>
                    </div>
                </div>
                <div class="this-scan-content" id="thisScanContent">
                    <p class="this-scan-hint" id="thisScanHint" role="status" aria-live="polite" style="display: none;"></p>
                    <div class="cards-grid this-scan-cards" id="resultsBody"></div>
                    <button class="add-book-btn" id="addBookBtn" data-i18n="addBook">+ P≈ôidat polo≈æku</button>
                </div>
            </div>
            </div>
            <!-- 4. MODULES/LibraryGrid.html -->
            <section class="scan-history" id="scanHistorySection">
                <!-- Varovn√° li≈°ta na opozdilce (zobraz√≠ se, kdy≈æ jsou po term√≠nu) -->
                <div class="borrowed-alarm-bar" id="borrowedAlarmBar" style="display: none;" role="alert">
                    <span class="borrowed-alarm-text" id="borrowedAlarmText">Pozor, jedna kn√≠≈æka se n√°m nƒõkde zapomnƒõla! Nƒõkdo ji m√° u sebe u≈æ moc dlouho‚Ä¶</span>
                    <button type="button" class="borrowed-alarm-btn" id="borrowedAlarmBtn">Poslat jemn√© popostrƒçen√≠</button>
                </div>
                <div class="scan-history-header" id="scanHistoryHeader">
                    <h2 class="scan-history-title" id="scanHistoryTitle" data-i18n="scanHistory">Moje knihovna</h2>
                    <p class="scan-history-subtitle" id="scanHistorySubtitle" aria-live="polite"></p>
                    <div class="library-view-toggle" id="libraryViewToggle" role="group" aria-label="Zp≈Øsob zobrazen√≠ knihovny">
                        <button type="button" class="library-view-btn active" id="libraryViewReality" data-view-mode="reality">Podle reality</button>
                        <button type="button" class="library-view-btn" id="libraryViewSmart" data-view-mode="smart">Chytr√© ≈ôazen√≠ (≈Ω√°nr/Autor)</button>
                        <button type="button" class="library-view-btn library-view-btn-help" id="libraryViewSmartHelp" aria-label="Co dƒõl√° chytr√© ≈ôazen√≠?" title="Co dƒõl√° chytr√© ≈ôazen√≠?">?</button>
                    </div>
                    <div class="scan-history-sort-wrap">
                        <select id="librarySortSelectHeader" class="library-global-sort-select" aria-label="Pokroƒçil√© t≈ô√≠dƒõn√≠ knihovny">
                            <option value="">T≈ô√≠dƒõn√≠‚Ä¶</option>
                            <option value="author">Autor A‚ÄìZ</option>
                            <option value="author_desc">Autor Z‚ÄìA</option>
                            <option value="genre">≈Ω√°nr</option>
                            <option value="status">Stav</option>
                            <option value="privacy">Sd√≠len√≠</option>
                        </select>
                        <span class="library-filter-summary" id="libraryFilterSummaryHeader" aria-live="polite"></span>
                    </div>
                    <div class="scan-history-search-wrap">
                        <button type="button" class="search-toggle-btn" id="searchToggleBtn" aria-label="Vyhledat v knihovnƒõ" title="Vyhledat">üîç</button>
                        <div class="search-field-slide" id="searchFieldSlide">
                            <input type="search" id="librarySearchInput" class="library-search-input" placeholder="Hledat podle n√°zvu nebo autora‚Ä¶" autocomplete="off" />
                        </div>
                    </div>
                </div>
                <!-- Banner: Wishlist otev≈ôen pro d√°rky (v ƒçase narozenin) + Rok narozen√≠ -->
                <div class="wishlist-birthday-banner" id="wishlistBirthdayBanner" style="display: none;" role="status" aria-live="polite">
                    <span class="wishlist-birthday-text">üéÇ Wishlist je otev≈ôen pro d√°rky ‚Äì rodina (FamilyID) m≈Ø≈æe vidƒõt, co si p≈ôeje≈°.</span>
                </div>
                <div class="wishlist-birthyear-row" id="wishlistBirthyearRow" style="display: none;">
                    <label for="wishlistBirthYearDisplay" class="wishlist-birthyear-label">Rok narozen√≠ (pro odemknut√≠ Wishlistu rodinƒõ v obdob√≠ narozenin)</label>
                    <input type="number" id="wishlistBirthYearDisplay" class="wishlist-birthyear-input" placeholder="nap≈ô. 1990" min="1900" max="2030" />
                    <p class="wishlist-birthday-note" id="wishlistBirthdayNote" style="display: none; margin-top: 8px; font-size: 0.8125rem; color: var(--text-muted);">Tato poliƒçka se v ƒçase tv√Ωch narozenin otev≈ôe rodinƒõ.</p>
                </div>
                <!-- Panel pro M√°m vyp≈Øjƒçeno: kompaktn√≠ rozbalovac√≠ formul√°≈ô -->
                <div class="borrowed-by-me-panel" id="borrowedByMePanel" style="display: none;" aria-label="M√°m vyp≈Øjƒçeno">
                    <div class="borrowed-by-me-status-bar" id="borrowedByMeStatusBar" aria-live="polite">
                        <span class="borrowed-by-me-status-text" id="borrowedByMeStatusText">Panel ‚ÄûP≈ôidat vyp≈Øjƒçenou knihu‚Äú je zav≈ôen√Ω</span>
                        <button type="button" class="borrowed-by-me-open-btn" id="btnOpenBorrowedByMe">Otev≈ô√≠t</button>
                        <button type="button" class="borrowed-by-me-close-btn" id="btnCloseBorrowedByMe" aria-label="Zav≈ô√≠t panel" title="Zav≈ô√≠t" hidden>√ó</button>
                    </div>
                    <div class="borrowed-by-me-body" id="borrowedByMeBody" hidden>
                        <form class="borrowed-by-me-form" id="borrowedByMeForm">
                            <div class="borrowed-by-me-form-title">P≈ôidat vyp≈Øjƒçenou knihu</div>
                            <div class="borrowed-by-me-form-row">
                                <label for="borrowedByMeTitle">N√°zev</label>
                                <input type="text" id="borrowedByMeTitle" placeholder="N√°zev knihy" />
                            </div>
                            <div class="borrowed-by-me-form-row">
                                <label for="borrowedByMeAuthor">Autor</label>
                                <input type="text" id="borrowedByMeAuthor" placeholder="Jm√©no autora" />
                            </div>
                            <div class="borrowed-by-me-form-row">
                                <label for="borrowedByMeFrom">Od koho p≈Øjƒçeno</label>
                                <input type="text" id="borrowedByMeFrom" placeholder="nap≈ô. Jana, Mƒõstsk√° knihovna" />
                            </div>
                            <div class="borrowed-by-me-form-row">
                                <label for="borrowedByMeReturn">Term√≠n vr√°cen√≠</label>
                                <input type="date" id="borrowedByMeReturn" placeholder="dd.mm.rrrr" />
                            </div>
                            <div class="borrowed-by-me-form-row">
                                <label class="borrowed-by-me-toggle-label">
                                    <input type="checkbox" id="borrowedByMeReading" />
                                    <span>Pr√°vƒõ ƒçtu</span>
                                </label>
                            </div>
                            <div class="borrowed-by-me-form-row">
                                <label for="borrowedByMeCoverInput">Ob√°lka / fotka</label>
                                <input type="file" id="borrowedByMeCoverInput" accept="image/*" />
                            </div>
                            <div class="borrowed-by-me-form-actions">
                                <button type="button" class="btn-scan-borrowed" id="btnScanBorrowedByMe">Naskenovat vyp≈Øjƒçenou knihu</button>
                                <button type="submit" class="btn-add-borrowed" id="btnAddBorrowedByMe">P≈ôidat</button>
                            </div>
                            <input type="file" id="borrowedByMeScanInput" accept="image/*" capture="environment" style="display:none;" />
                        </form>
                    </div>
                </div>
                <!-- Horn√≠ panel pro P≈Øjƒçil/a jsem: vyhled√°vaƒç + formul√°≈ô -->
                <div class="borrowed-top-panel" id="borrowedTopPanel" style="display: none;" aria-label="P≈Øjƒçit knihu">
                    <div class="borrowed-panel-inner">
                        <label for="borrowedSearchInput" class="borrowed-panel-label">Vyhledat knihu ze sb√≠rky (kterou chci p≈Øjƒçit!)</label>
                        <input type="text" id="borrowedSearchInput" class="borrowed-search-input" placeholder="N√°zev nebo autor‚Ä¶" autocomplete="off" />
                        <div class="borrowed-search-results" id="borrowedSearchResults" role="listbox" aria-label="V√Ωsledky vyhled√°v√°n√≠" style="display: none;"></div>
                        <div class="borrowed-lend-form" id="borrowedLendForm" style="display: none;">
                            <div class="borrowed-form-row">
                                <label for="borrowedToInput">Komu p≈Øjƒçuji?</label>
                                <input type="text" id="borrowedToInput" class="borrowed-form-input" placeholder="Jm√©no" />
                            </div>
                            <div class="borrowed-form-row">
                                <label for="borrowedDueInput">Do kdy?</label>
                                <input type="date" id="borrowedDueInput" class="borrowed-form-input" />
                            </div>
                            <button type="button" class="borrowed-submit-btn" id="borrowedSubmitBtn">Oznaƒçit jako p≈Øjƒçen√©</button>
                        </div>
                    </div>
                </div>
                <!-- Horn√≠ panel pro Na prodej: vyhledat knihu ze sb√≠rky -->
                <div class="borrowed-top-panel" id="forSaleTopPanel" style="display: none;" aria-label="Na prodej">
                    <div class="borrowed-panel-inner">
                        <label for="forSaleSearchInput" class="borrowed-panel-label">Vyhledat knihu ze sb√≠rky (kterou chci prodat)</label>
                        <input type="text" id="forSaleSearchInput" class="borrowed-search-input" placeholder="N√°zev nebo autor‚Ä¶" autocomplete="off" />
                        <div class="borrowed-search-results" id="forSaleSearchResults" role="listbox" aria-label="V√Ωsledky vyhled√°v√°n√≠" style="display: none;"></div>
                    </div>
                </div>
                <!-- O co maj√≠ z√°jem p≈ô√°tel√©: zobrazuje se v Na prodej -->
                <section class="friends-interests-section" id="friendsInterestsSection" style="display: none;">
                    <h2>O co maj√≠ z√°jem p≈ô√°tel√©</h2>
                    <div class="friend-demands-grid" id="friendDemandsGrid"></div>
                </section>
                <div id="scanHistoryContent" class="scan-history-content-wrap">
                    <div id="pujceno-container" class="pujceno-container" style="display: none;"></div>
                    <div id="borrowed-by-me-container" class="borrowed-by-me-container borrowed-shelf" style="display: none;"></div>
                    <h3 class="policka-vedle-title" id="polickaVedleTitle" style="display: none;" aria-label="Police od vedle">Police od vedle (vyp≈Øjƒçen√© kn√≠≈æky)</h3>
                    <div class="empty-state" id="emptyState">
                        <div class="empty-state-icon">üìñ</div>
                        <p data-i18n="scannedBooksAppear">Naskenovan√© knihy se zobraz√≠ zde.</p>
                    </div>
                    <div class="books-grid" id="scanHistoryGrid" style="display: none;"></div>
                    <!-- Okno pro vzkazy a reference od vyp≈Øjƒçitel≈Ø (P≈Øjƒçil/a jsem) -->
                    <div class="borrowed-messages-panel" id="borrowedMessagesPanel" style="display: none;">
                        <h3 class="borrowed-messages-title">Vzkazy a reference</h3>
                        <div class="borrowed-messages-body" id="borrowedMessagesBody">
                            <p class="borrowed-messages-placeholder">Ahoj Katy, moc dƒõkuji za puƒçen√≠ knihy, byla fenomen√°ln√≠.</p>
                        </div>
                        <div class="borrowed-messages-actions">
                            <button type="button" class="borrowed-msg-btn" id="borrowedAddToRefBtn">p≈ôidat k referenci knihy</button>
                            <button type="button" class="borrowed-msg-btn" id="borrowedThankBtn">poslat podƒõkov√°n√≠ za zpr√°vu</button>
                        </div>
                    </div>
                </div>
            </section>
            <!-- Sekce ‚ÄûP≈ô√°tel√© doporuƒçuj√≠‚Äú ‚Äì interaktivn√≠ soci√°ln√≠ doporuƒçen√≠ (zobrazuje se jen ve view friendsHighlights) -->
            <section class="friends-reco-section" id="friendsRecommendationsSection" style="display: none;">
                <div class="friends-reco-header">
                    <h2 class="friends-reco-title">P≈ô√°tel√© doporuƒçuj√≠</h2>
                    <div class="friends-reco-header-actions">
                        <button type="button" class="friends-reco-tab active" data-friends-tab="search">Hledat</button>
                        <button type="button" class="friends-reco-tab" data-friends-tab="add">Zadat</button>
                        <button type="button" class="friends-reco-tab" data-friends-tab="ai">AI online</button>
                    </div>
                </div>

                <div class="friends-reco-panel friends-reco-panel--search" id="friendsRecoPanelSearch">
                    <div class="friends-reco-accordion collapsed" id="friendsRecoAccordion">
                        <button type="button" class="friends-reco-accordion-toggle" id="friendsRecoAccordionToggle" aria-expanded="false">
                            <span>üîé Vyhled√°v√°n√≠ doporuƒçen√≠</span>
                            <span class="friends-reco-accordion-chevron">‚ñº</span>
                        </button>
                        <div class="friends-reco-accordion-body" id="friendsRecoAccordionBody" hidden>
                            <div class="friends-reco-filters">
                                <div class="friends-reco-filter">
                                    <label for="friendsFilterName">Jm√©no</label>
                                    <input type="text" id="friendsFilterName" placeholder="nap≈ô. Jana B." />
                                </div>
                                <div class="friends-reco-filter">
                                    <label for="friendsFilterTitle">N√°zev knihy</label>
                                    <input type="text" id="friendsFilterTitle" placeholder="nap≈ô. Duna" />
                                </div>
                                <div class="friends-reco-filter">
                                    <label for="friendsFilterAuthor">Autor</label>
                                    <input type="text" id="friendsFilterAuthor" placeholder="nap≈ô. Frank Herbert" />
                                </div>
                                <div class="friends-reco-filter">
                                    <label for="friendsFilterGenre">≈Ω√°nr</label>
                                    <input type="text" id="friendsFilterGenre" placeholder="nap≈ô. Sci‚Äëfi" />
                                </div>
                                <div class="friends-reco-filter">
                                    <label for="friendsFilterCircle">Okruh lid√≠</label>
                                    <select id="friendsFilterCircle">
                                        <option value="">V≈°ichni</option>
                                        <option value="friends">Okruh p≈ô√°tel</option>
                                        <option value="family">Rodina</option>
                                        <option value="public">Ve≈ôejn√©</option>
                                    </select>
                                </div>
                                <div class="friends-reco-filter">
                                    <label for="friendsFilterSort">≈òazen√≠</label>
                                    <select id="friendsFilterSort">
                                        <option value="newest">Nejnovƒõj≈°√≠</option>
                                        <option value="interesting">Nejzaj√≠mavƒõj≈°√≠</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="friends-reco-seed-note" id="friendsRecoSeedNote" hidden>Uk√°zky doporuƒçen√≠ (demo) ‚Äì p≈ôejdƒõte na ‚ÄûZadat‚Äú a p≈ôidejte vlastn√≠.</div>
                    <div class="friends-reco-grid" id="friendsRecoGrid" aria-live="polite"></div>
                    <div class="friends-reco-empty" id="friendsRecoEmpty" style="display:none;">
                        Zat√≠m tu nejsou ≈æ√°dn√° doporuƒçen√≠. P≈ôepni na ‚ÄûZadat‚Äú a p≈ôidej prvn√≠ vzkaz.
                    </div>
                </div>

                <div class="friends-reco-panel friends-reco-panel--add" id="friendsRecoPanelAdd" hidden>
                    <form class="friends-reco-add-form" id="friendsRecoAddForm">
                        <div class="friends-reco-add-grid">
                            <div class="friends-reco-add-field">
                                <label for="friendsAddFrom">Kdo doporuƒçuje</label>
                                <input type="text" id="friendsAddFrom" placeholder="nap≈ô. Martin K." required />
                            </div>
                            <div class="friends-reco-add-field">
                                <label for="friendsAddTitle">N√°zev knihy</label>
                                <input type="text" id="friendsAddTitle" placeholder="nap≈ô. Mal√Ω princ" required />
                            </div>
                            <div class="friends-reco-add-field">
                                <label for="friendsAddAuthor">Autor</label>
                                <input type="text" id="friendsAddAuthor" placeholder="nap≈ô. Antoine de Saint‚ÄëExup√©ry" />
                            </div>
                            <div class="friends-reco-add-field">
                                <label for="friendsAddGenre">≈Ω√°nr</label>
                                <input type="text" id="friendsAddGenre" placeholder="nap≈ô. Poh√°dka / filozofie" />
                            </div>
                            <div class="friends-reco-add-field">
                                <label for="friendsAddCircle">Okruh lid√≠</label>
                                <select id="friendsAddCircle">
                                    <option value="friends">Okruh p≈ô√°tel</option>
                                    <option value="family">Rodina</option>
                                    <option value="public">Ve≈ôejn√°</option>
                                </select>
                            </div>
                            <div class="friends-reco-add-field">
                                <label for="friendsAddAvailability">Dostupnost</label>
                                <select id="friendsAddAvailability">
                                    <option value="available">Lze zap≈Øjƒçit</option>
                                    <option value="unavailable">Teƒè nezap≈Øjƒçuji</option>
                                </select>
                            </div>
                        </div>
                        <div class="friends-reco-privacy">
                            <div class="friends-reco-privacy-title">Soukrom√≠ recenze</div>
                            <div class="friends-reco-privacy-seg" role="group" aria-label="Soukrom√≠ recenze">
                                <label class="friends-reco-privacy-opt"><input type="radio" name="friendsPrivacy" value="public"> Ve≈ôejn√°</label>
                                <label class="friends-reco-privacy-opt"><input type="radio" name="friendsPrivacy" value="friends" checked> Okruh p≈ô√°tel</label>
                                <label class="friends-reco-privacy-opt"><input type="radio" name="friendsPrivacy" value="family"> Rodina</label>
                            </div>
                        </div>
                        <div class="friends-reco-add-message">
                            <label for="friendsAddMessage">Bublinov√Ω vzkaz (odkaz)</label>
                            <textarea id="friendsAddMessage" rows="3" placeholder="Kr√°tce a v√Ωsti≈ænƒõ: proƒç je to skvƒõl√©, pro koho, n√°lada‚Ä¶"></textarea>
                        </div>
                        <div class="friends-reco-add-actions">
                            <button type="submit" class="friends-reco-add-btn">P≈ôidat doporuƒçen√≠</button>
                        </div>
                    </form>
                    <div class="friends-reco-add-hint">
                        Tip: Pokud zvol√≠≈° ‚ÄûVe≈ôejn√°‚Äú, doporuƒçen√≠ se ‚Äûp≈ôip√≠chne‚Äú ke v≈°em stejn√Ωm knih√°m (podle ISBN nebo n√°zvu+autora).
                    </div>
                </div>

                <div class="friends-reco-panel friends-reco-panel--ai" id="friendsRecoPanelAi" hidden>
                    <div class="friends-reco-ai-card">
                        <div class="friends-reco-ai-title">Vyhledat online pomoc√≠ AI</div>
                        <p class="friends-reco-ai-sub">Zadej t√©ma, knihu nebo autora. (Integrace se zapoj√≠ v dal≈°√≠m kroku.)</p>
                        <div class="friends-reco-ai-row">
                            <input type="text" id="friendsAiQuery" placeholder="nap≈ô. 'nejlep≈°√≠ sci‚Äëfi pro fanou≈°ky Duny'" />
                            <button type="button" class="friends-reco-ai-btn" id="friendsAiBtn" disabled>Vyhledat</button>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>
    <script>console.log('Navigace aktivn√≠');</script>
    <!-- Mod√°l: Co dƒõl√° chytr√© ≈ôazen√≠? -->
    <div class="smart-sort-help-overlay" id="smartSortHelpOverlay" role="dialog" aria-labelledby="smartSortHelpTitle" style="display: none;">
        <div class="smart-sort-help-modal">
            <h2 id="smartSortHelpTitle">Co dƒõl√° chytr√© ≈ôazen√≠?</h2>
            <p>AI ti pom≈Ø≈æe <strong>virtu√°lnƒõ p≈ôeskl√°dat</strong> knihy podle barvy, ≈æ√°nru nebo autora ‚Äì jen pro inspiraci, <strong>fyzick√© um√≠stƒõn√≠ na polici se nemƒõn√≠</strong>. M≈Ø≈æe≈° si prohl√©dnout sb√≠rku v nov√©m po≈ôad√≠ a pak se podle toho inspirovat, jak to udƒõlat v re√°lu.</p>
            <button type="button" class="smart-sort-help-close" id="smartSortHelpClose">Zav≈ô√≠t</button>
        </div>
    </div>
    <!-- AI asistent ‚Äì vyskakovac√≠ bublina v prav√©m doln√≠m rohu (OmniSupport AI) -->
    <div class="ai-assistant-bubble-wrap" id="aiAssistantBubbleWrap" aria-label="AI asistent">
        <div class="ai-assistant-bubble" id="aiAssistantBubble">
            <div class="ai-assistant-bubble-panel" id="aiAssistantBubblePanel">
                <div class="ai-assistant-bubble-header">
                    <span class="ai-assistant-bubble-icon" aria-hidden="true">ü§ñ</span>
                    <h3 class="ai-assistant-bubble-title">OmniSupport AI</h3>
                </div>
                <p class="ai-assistant-bubble-greeting" id="aiAssistantBubbleText">Ahoj! Jsem OmniSupport AI. M≈Ø≈æe≈° se mƒõ zeptat nap≈ô.: Jak p≈ôid√°m knihu? Jak skenuji poliƒçku? Nebo nahl√°sit chybu tlaƒç√≠tkem n√≠≈æe.</p>
                <button type="button" class="ai-assistant-bubble-report" id="aiAssistantBubbleReport">üêõ Nahl√°sit chybu</button>
                <div class="ai-assistant-bubble-input-wrap">
                    <input type="text" class="ai-assistant-bubble-input" id="aiAssistantBubbleInput" placeholder="Zeptejte se na cokoli o aplikaci." autocomplete="off" />
                    <button type="button" class="ai-assistant-bubble-send" id="aiAssistantBubbleSend">Odeslat</button>
                </div>
            </div>
            <button type="button" class="ai-assistant-bubble-toggle" id="aiAssistantBubbleToggle" aria-label="Zav≈ô√≠t / otev≈ô√≠t asistenta">üí¨</button>
        </div>
    </div>
    <!-- Mod√°l Tr≈æi≈°tƒõ: Prodat duplicitu / Koupit z Wishlistu -->
    <div class="marketplace-modal-overlay" id="marketplaceModalOverlay" role="dialog" aria-labelledby="marketplaceModalTitle" style="display: none;">
        <div class="marketplace-modal" id="marketplaceModal">
            <div class="marketplace-modal-header">
                <h2 id="marketplaceModalTitle">Tr≈æi≈°tƒõ a obchody</h2>
                <button type="button" class="marketplace-modal-close" id="marketplaceModalClose" aria-label="Zav≈ô√≠t">√ó</button>
            </div>
            <div class="marketplace-modal-body">
                <div class="marketplace-section">
                    <h3>Prodat duplicitu</h3>
                    <p>Oznaƒç knihu jako ‚ÄûNa prodej‚Äú a p≈ôidej odhadovanou cenu ‚Äì objev√≠ se v sekci Na prodej.</p>
                    <button type="button" class="marketplace-btn" id="btnSellDuplicate">Oznaƒçit knihu na prodej</button>
                </div>
                <div class="marketplace-section">
                    <h3>Koupit z Wishlistu</h3>
                    <p>Polo≈æky z Wishlistu m≈Ø≈æe≈° vyhledat v obchodech jedn√≠m klikem.</p>
                    <button type="button" class="marketplace-btn" id="btnBuyFromWishlist">Otev≈ô√≠t Wishlist v obchodech</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Mod√°l detail knihy v Tr≈æi≈°ti (rozkliknut√≠ karty: informace, prod√°vaj√≠c√≠, Koupit / Domluvit se) -->
    <div class="marketplace-detail-overlay" id="marketplaceDetailOverlay" role="dialog" aria-labelledby="marketplaceDetailTitle" aria-modal="true" style="display: none;">
        <div class="marketplace-detail-modal" id="marketplaceDetailModal">
            <div class="marketplace-detail-header">
                <h2 id="marketplaceDetailTitle" class="marketplace-detail-title">Detail knihy</h2>
                <button type="button" class="marketplace-detail-close" id="marketplaceDetailClose" aria-label="Zav≈ô√≠t">√ó</button>
            </div>
            <div class="marketplace-detail-body">
                <div class="marketplace-detail-cover-wrap" id="marketplaceDetailCover"></div>
                <div class="marketplace-detail-info">
                    <h3 id="marketplaceDetailBookTitle"></h3>
                    <p id="marketplaceDetailAuthor" class="marketplace-detail-author"></p>
                    <p id="marketplaceDetailStatus" class="marketplace-detail-status" style="display:none;"></p>
                    <p id="marketplaceDetailPrice" class="marketplace-detail-price" style="display:none;"></p>
                    <p id="marketplaceDetailBubble" class="marketplace-detail-bubble" style="display:none;" aria-label="Vzkaz majitele"></p>
                    <p id="marketplaceDetailReviews" class="marketplace-detail-meta">Recenze: zat√≠m bez recenz√≠.</p>
                    <p id="marketplaceDetailContent" class="marketplace-detail-meta">Info o obsahu knihy se naƒçte zde.</p>
                    <p id="marketplaceDetailSeller" class="marketplace-detail-seller">Prod√°v√°: ‚Äî</p>
                    <p id="marketplaceDetailWhere" class="marketplace-detail-meta">Kde: ‚Äî</p>
                </div>
                <div class="marketplace-detail-actions">
                    <button type="button" class="marketplace-detail-btn marketplace-detail-btn--buy" id="marketplaceDetailBtnBuy">Koupit ‚Äì vhodit do ko≈°√≠ku</button>
                    <button type="button" class="marketplace-detail-btn marketplace-detail-btn--contact" id="marketplaceDetailBtnContact">Napsat majiteli</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Kontejner pro mod√°l Upravit knihu ‚Äì nad ostatn√≠mi prvky (z-index) -->
    <div class="edit-book-modal-overlay" id="editBookModalOverlay" role="dialog" aria-modal="true" aria-labelledby="editBookModalTitle" style="display: none;">
        <div class="edit-book-modal" id="editBookModal">
            <div class="edit-book-modal-header">
                <h2 class="edit-book-modal-title" id="editBookModalTitle">Upravit knihu</h2>
                <button type="button" class="edit-book-modal-close" id="editBookModalClose" aria-label="Zav≈ô√≠t" onclick="typeof closeEditModal === 'function' && closeEditModal();">√ó</button>
            </div>
            <div class="edit-book-modal-body">
                <div class="edit-book-top">
                    <div class="edit-book-modal-cover-wrap">
                        <div class="edit-book-cover-preview" id="editBookCoverPreview">
                            <span class="edit-book-cover-placeholder">N√°hled ob√°lky</span>
                        </div>
                        <label class="edit-book-cover-change" id="editBookCoverChangeLabel">
                            <input type="file" id="editBookCoverInput" accept="image/*" style="display: none;" />
                            <span class="edit-book-cover-change-text">Zmƒõnit ob√°lku</span>
                        </label>
                    </div>
                    <div class="edit-book-basic">
                        <div class="edit-book-field">
                            <label for="editBookTitle">N√°zev</label>
                            <input type="text" id="editBookTitle" placeholder="N√°zev knihy" />
                        </div>
                        <div class="edit-book-field">
                            <label for="editBookAuthor">Autor</label>
                            <input type="text" id="editBookAuthor" placeholder="Autor" />
                        </div>
                        <div class="edit-book-section-title" aria-hidden="true">Stav</div>
                        <div class="edit-book-field">
                            <label for="editBookReadingStatus">Status ƒçten√≠</label>
                            <select id="editBookReadingStatus">
                                <option value="unread">Nep≈ôeƒçteno</option>
                                <option value="reading">Rozeƒçteno</option>
                                <option value="read">P≈ôeƒçten√©</option>
                            </select>
                        </div>
                        <div class="edit-book-field">
                            <label for="editBookOwnershipStatus">Status vlastnictv√≠</label>
                            <select id="editBookOwnershipStatus">
                                <option value="mine">Moje</option>
                                <option value="borrowed">P≈Øjƒçeno nƒõkomu</option>
                                <option value="borrowedByMe">M√°m vyp≈Øjƒçeno</option>
                                <option value="forSale">Na prodej</option>
                                <option value="daruji">Daruji</option>
                                <option value="vymena">V√Ωmƒõna</option>
                                <option value="wishlist">Wishlist</option>
                            </select>
                        </div>
                        <div class="edit-book-section-title" aria-hidden="true">Viditelnost</div>
                        <div class="edit-book-field">
                            <label for="editBookPrivacy">Soukrom√≠</label>
                            <select id="editBookPrivacy">
                                <option value="private">Soukrom√°</option>
                                <option value="family">Rodina</option>
                                <option value="public">Ve≈ôejn√°</option>
                            </select>
                        </div>
                        <div class="edit-book-field edit-book-borrowed-wrap" id="editBookBorrowedWrap" style="display: none;">
                            <label for="editBookBorrowedTo">Komu</label>
                            <input type="text" id="editBookBorrowedTo" placeholder="Komu je kniha p≈Øjƒçen√°" />
                            <label for="editBookReturnDueDate">Vr√°tit do</label>
                            <input type="date" id="editBookReturnDueDate" placeholder="Datum vr√°cen√≠" />
                            <label for="editBookBorrowedNote">Stav / Pozn√°mka</label>
                            <input type="text" id="editBookBorrowedNote" placeholder="nap≈ô. nov√°, po≈°kozen√°" />
                            <div class="edit-book-return-section" id="editBookReturnSection" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(0,0,0,0.1);">
                                <label for="editBookReturnStatus">Stav knihy</label>
                                <select id="editBookReturnStatus" style="width: 100%; padding: 8px; margin-bottom: 12px; border: 1px solid rgba(0,0,0,0.2); border-radius: 6px;">
                                    <option value="borrowed">P≈Øjƒçeno</option>
                                    <option value="returned">Vr√°cena na m√≠sto</option>
                                </select>
                                <label for="editBookReturnLocation">Aktu√°ln√≠ um√≠stƒõn√≠ (Poliƒçka/M√≠stnost)</label>
                                <input type="text" id="editBookReturnLocation" placeholder="nap≈ô. Lo≈ænice 1" />
                                <p style="font-size: 0.75rem; color: #666; margin-top: 8px;">Tato informace bude pou≈æita pro virtu√°ln√≠ mapu.</p>
                            </div>
                        </div>
                        <div class="edit-book-field edit-book-borrowed-by-me-wrap" id="editBookBorrowedByMeWrap" style="display: none;">
                            <label for="editBookBorrowedFrom">Od koho</label>
                            <input type="text" id="editBookBorrowedFrom" placeholder="Od koho m√°m knihu vyp≈Øjƒçenou" />
                            <label for="editBookReturnDueDateByMe">Vr√°tit do</label>
                            <input type="date" id="editBookReturnDueDateByMe" placeholder="Datum vr√°cen√≠" />
                        </div>
                    </div>
                </div>
                <div class="edit-book-voice-section">
                    <button type="button" class="edit-book-voice-btn" id="editBookVoiceBtn" onclick="typeof toggleAudioRecording === 'function' && toggleAudioRecording();" aria-label="Hlasov√° pozn√°mka">
                        <span class="edit-book-voice-icon" aria-hidden="true">üé§</span>
                        <span class="edit-book-voice-label">Hlasov√° pozn√°mka/recenze</span>
                    </button>
                    <div class="edit-book-waveform" id="editBookWaveform" style="display: none;" aria-hidden="true">
                        <span class="edit-book-waveform-bar"></span>
                        <span class="edit-book-waveform-bar"></span>
                        <span class="edit-book-waveform-bar"></span>
                        <span class="edit-book-waveform-bar"></span>
                        <span class="edit-book-waveform-bar"></span>
                        <span class="edit-book-waveform-bar"></span>
                        <span class="edit-book-waveform-bar"></span>
                        <span class="edit-book-waveform-bar"></span>
                    </div>
                </div>
                <div class="edit-book-accordion">
                    <button type="button" class="edit-book-accordion-toggle" id="editBookAccordionToggle" onclick="typeof toggleAccordion === 'function' && toggleAccordion();" aria-expanded="false" aria-controls="editBookAccordionContent">
                        <span>V√≠ce informac√≠</span>
                        <svg class="edit-book-accordion-chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
                    </button>
                    <div class="edit-book-accordion-content" id="editBookAccordionContent" aria-hidden="true">
                        <div class="edit-book-modal-fields">
                            <div class="edit-book-field">
                                <label for="editBookIsbn">ISBN/EAN</label>
                                <input type="text" id="editBookIsbn" placeholder="nap≈ô. 978-80-123-4567-8" inputmode="numeric" />
                            </div>
                            <div class="edit-book-field">
                                <label for="editBookGenre">≈Ω√°nr</label>
                                <input type="text" id="editBookGenre" placeholder="≈Ω√°nr" />
                            </div>
                            <div class="edit-book-field">
                                <label for="editBookYear">Rok vyd√°n√≠</label>
                                <input type="text" id="editBookYear" placeholder="nap≈ô. 2020" inputmode="numeric" />
                            </div>
                            <div class="edit-book-field">
                                <label for="editBookEstimatedValue">Odhadovan√° hodnota</label>
                                <input type="text" id="editBookEstimatedValue" placeholder="nap≈ô. 200 Kƒç" />
                            </div>
                            <div class="edit-book-field edit-book-field-location">
                                <label for="editBookLocationSelect">Um√≠stƒõn√≠</label>
                                <select id="editBookLocationSelect" class="edit-book-location-select" aria-label="Vyber poliƒçku">
                                    <option value="‚Äî Bez poliƒçky ‚Äî">‚Äî Bez poliƒçky ‚Äî</option>
                                </select>
                                <div class="edit-book-location-new-wrap" id="editBookLocationNewWrap" style="display: none;">
                                    <label for="editBookLocationNew">N√°zev nov√© poliƒçky</label>
                                    <input type="text" id="editBookLocationNew" placeholder="nap≈ô. Ob√Ωv√°k - horn√≠" />
                                </div>
                            </div>
                            <div class="edit-book-field">
                                <label for="editBookOwner">Vlastn√≠k</label>
                                <input type="text" id="editBookOwner" placeholder="Vlastn√≠k" />
                            </div>
                            <div class="edit-book-field">
                                <label for="editBookPosition">Pozice na polici</label>
                                <input type="text" id="editBookPosition" placeholder="nap≈ô. vlevo, uprost≈ôed" />
                            </div>
                            <div class="edit-book-field">
                                <label for="editBookReadingProgress">Progres ƒçten√≠ (%)</label>
                                <input type="number" id="editBookReadingProgress" min="0" max="100" placeholder="0‚Äì100" />
                            </div>
                            <div class="edit-book-field edit-book-field-full">
                                <label for="editBookAiSummary">AI Sum√°≈ô</label>
                                <textarea id="editBookAiSummary" rows="8" placeholder="Shrnut√≠ nebo pozn√°mky‚Ä¶"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="edit-book-modal-footer">
                <button type="button" class="btn-edit-book-save" id="editBookModalSave">Ulo≈æit</button>
                <button type="button" class="btn-expose-marketplace btn-edit-book-marketplace" id="editBookModalExposeMarketplace" title="Vystavit knihu na Tr≈æi≈°ti (Na prodej)">üè∑Ô∏è Vystavit na Tr≈æi≈°ti</button>
                <button type="button" class="btn-share-marketplace btn-edit-book-marketplace" id="editBookModalShareMarketplace" title="Zve≈ôejnit v Tr≈æi≈°ti se statusem K zap≈Øjƒçen√≠">üì§ Sd√≠let v Tr≈æi≈°ti</button>
                <button type="button" class="btn-open-pracovna btn-edit-book-pracovna" id="editBookModalPracovna">üìñ P≈ôej√≠t do Pracovny</button>
            </div>
        </div>
    </div>
    <!-- Mod√°l Historie vyp≈Øjƒçitel≈Ø (P≈Øjƒçila jsem) -->
    <div class="borrowed-history-overlay" id="borrowedHistoryOverlay" role="dialog" aria-modal="true" aria-labelledby="borrowedHistoryTitle" style="display: none;">
        <div class="borrowed-history-modal" id="borrowedHistoryModal">
            <div class="borrowed-history-header">
                <h2 class="borrowed-history-title" id="borrowedHistoryTitle">Historie vyp≈Øjƒçitel≈Ø</h2>
                <button type="button" class="borrowed-history-close" id="borrowedHistoryClose" aria-label="Zav≈ô√≠t">√ó</button>
            </div>
            <div class="borrowed-history-body" id="borrowedHistoryBody"></div>
        </div>
    </div>
    <!-- Mod√°l AI upom√≠nka (Mil√° / D≈Ørazn√°) -->
    <div class="borrowed-reminder-overlay" id="borrowedReminderOverlay" role="dialog" aria-modal="true" style="display: none;">
        <div class="borrowed-reminder-modal" id="borrowedReminderModal">
            <div class="borrowed-reminder-header">
                <h2 class="borrowed-reminder-title">Upom√≠nka</h2>
                <button type="button" class="borrowed-reminder-close" id="borrowedReminderClose" aria-label="Zav≈ô√≠t">√ó</button>
            </div>
            <div class="borrowed-reminder-choices" id="borrowedReminderChoices">
                <button type="button" class="borrowed-reminder-btn" data-tone="friendly">Mil√°</button>
                <button type="button" class="borrowed-reminder-btn" data-tone="firm">D≈Ørazn√°</button>
            </div>
            <div class="borrowed-reminder-result" id="borrowedReminderResult" style="display: none;"></div>
        </div>
    </div>
    <!-- Mod√°l Odpovƒõdƒõt / Poslat podƒõkov√°n√≠ (itemChat ‚Äì pou≈æiteln√© pro P≈Øjƒçil/a jsem, F√≥rum, Tr≈æi≈°tƒõ, P≈Øjƒçovna) -->
    <div class="item-chat-reply-overlay" id="itemChatReplyModalOverlay" role="dialog" aria-modal="true" aria-labelledby="itemChatReplyModalTitle" style="display: none;">
        <div class="item-chat-reply-modal">
            <div class="item-chat-reply-header">
                <h2 class="item-chat-reply-title" id="itemChatReplyModalTitle">Poslat podƒõkov√°n√≠ / Odpovƒõdƒõt</h2>
                <button type="button" class="item-chat-reply-close" id="itemChatReplyModalClose" aria-label="Zav≈ô√≠t">√ó</button>
            </div>
            <div class="item-chat-reply-body">
                <label for="itemChatReplyModalText" class="item-chat-reply-label">Vzkaz adres√°tovi</label>
                <textarea id="itemChatReplyModalText" class="item-chat-reply-textarea" rows="4" placeholder="Napi≈°te vzkaz‚Ä¶"></textarea>
            </div>
            <div class="item-chat-reply-footer">
                <button type="button" class="item-chat-reply-send" id="itemChatReplyModalSend">Odeslat</button>
            </div>
        </div>
    </div>
    <!-- Mod√°l Cen√≠k (CZK) -->
    <div class="pricing-modal-overlay" id="pricingModalOverlay" role="dialog" aria-modal="true" aria-labelledby="pricingModalTitle" aria-hidden="true">
        <div class="pricing-modal" id="pricingModal">
            <div class="pricing-modal-header">
                <h2 class="pricing-modal-title" id="pricingModalTitle">Cen√≠k</h2>
                <button type="button" class="pricing-modal-close" id="pricingModalClose" aria-label="Zav≈ô√≠t">√ó</button>
            </div>
            <div class="pricing-billing-toggle-wrap">
                <span class="pricing-billing-label">Obdob√≠:</span>
                <div class="pricing-billing-toggle" role="group" aria-label="Mƒõs√≠ƒçn√≠ nebo roƒçn√≠ platba">
                    <button type="button" class="pricing-billing-btn active" id="pricingBillingMonthly" data-interval="monthly">Mƒõs√≠ƒçnƒõ</button>
                    <button type="button" class="pricing-billing-btn" id="pricingBillingYearly" data-interval="yearly">Roƒçnƒõ <span class="pricing-billing-badge">‚àí20 %</span></button>
                </div>
            </div>
            <div class="pricing-table-wrap">
                <table class="pricing-table" id="pricingTable">
                    <thead>
                        <tr>
                            <th>Tarif</th>
                            <th>Cena</th>
                            <th>Co z√≠sk√°te</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="pricing-tier-name" data-label="">FREE</td>
                            <td data-label="Cena"><span class="pricing-price" id="priceFree">0 Kƒç</span><br><span class="pricing-price-year" id="priceFreeYear">v≈ædy zdarma</span></td>
                            <td data-label="Co z√≠sk√°te"><span class="pricing-desc">Z√°kladn√≠ Knihovna, 1 sektor</span></td>
                            <td class="pricing-cta" data-label=""><button type="button" class="btn-pricing btn-pricing-free" disabled>Aktu√°ln√≠ tarif</button></td>
                        </tr>
                        <tr>
                            <td class="pricing-tier-name" data-label="">PRO</td>
                            <td data-label="Cena"><span class="pricing-price" id="pricePro">149 Kƒç</span><span class="pricing-price-year" id="priceProSuffix">/mƒõs√≠c</span><br><span class="pricing-price-year" id="priceProYear" style="display:none;">1 430 Kƒç/rok</span></td>
                            <td data-label="Co z√≠sk√°te"><span class="pricing-desc">V≈°echny sektory (D√≠lna, ≈†atn√≠k‚Ä¶), neomezen√© nahr√°v√°n√≠, Vizu√°ln√≠ mapy</span></td>
                            <td class="pricing-cta" data-label=""><button type="button" class="btn-pricing btn-pricing-pro" id="btnPricingPro">P≈ôedplatit</button></td>
                        </tr>
                        <tr>
                            <td class="pricing-tier-name" data-label="">FAMILY / KIDS</td>
                            <td data-label="Cena"><span class="pricing-price" id="priceFamily">249 Kƒç</span><span class="pricing-price-year" id="priceFamilySuffix">/mƒõs√≠c</span><br><span class="pricing-price-year" id="priceFamilyYear" style="display:none;">2 390 Kƒç/rok</span></td>
                            <td data-label="Co z√≠sk√°te"><span class="pricing-desc">V≈°e z PRO + OmniShelf Kids pro celou rodinu</span></td>
                            <td class="pricing-cta" data-label=""><button type="button" class="btn-pricing btn-pricing-family" id="btnPricingFamily">P≈ôedplatit</button></td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="pricing-upgrade-confirmation" id="pricingUpgradeConfirmation" role="status" aria-live="polite" style="display: none;">
                V√≠tejte v Premium! Va≈°e v√Ωhody jsou nyn√≠ aktivn√≠.
            </div>
        </div>
    </div>
    <!-- Mod√°l Tvoje nastaven√≠ (glob√°ln√≠) -->
    <div class="settings-modal-overlay" id="settingsModalOverlay" role="dialog" aria-modal="true" aria-labelledby="settingsModalTitle" style="display: none;">
        <div class="settings-modal wishlist-modal" id="settingsModal">
            <div class="wishlist-modal-content settings-modal-content">
                <h3 class="settings-modal-title" id="settingsModalTitle">Tvoje nastaven√≠</h3>
                <p class="settings-current-tier" id="settingsCurrentTier" aria-live="polite"></p>
                <div class="settings-modal-body">
                    <div class="settings-section settings-section-adult">
                        <p class="settings-section-title">Jak se dnes budeme bavit?</p>
                        <p class="settings-hint" style="font-size:0.8rem;margin:0 0 8px;color:var(--text-muted);">T√≥n hlasu AI asistenta a text≈Ø v aplikaci.</p>
                        <select id="settingsVoiceTone" class="settings-input" style="width:100%;padding:8px 12px;border:1px solid var(--border);border-radius:6px;font-size:0.9rem;">
                            <option value="friendly">Kamar√°dsky</option>
                            <option value="kind">Mil√Ω</option>
                            <option value="funny">Vtipn√Ω</option>
                            <option value="motivating">Motivuje mƒõ</option>
                            <option value="serious">Seri√≥zn√≠ / Vƒõdeck√Ω</option>
                        </select>
                    </div>
                    <div class="settings-section settings-section-adult">
                        <p class="settings-section-title">Narozeniny (pro Wishlist a d√°rky)</p>
                        <p class="settings-hint" style="font-size:0.8rem;margin:0 0 8px;color:var(--text-muted);">V obdob√≠ narozenin se Wishlist odemkne rodinƒõ (FamilyID), aby vƒõdƒõli, co koupit jako d√°rek.</p>
                        <label for="settingsBirthday" class="settings-label">Datum narozen√≠ (mƒõs√≠c-den)</label>
                        <input type="text" id="settingsBirthday" class="settings-input" placeholder="MM-DD nap≈ô. 12-25" maxlength="5" style="width:100%;padding:8px 12px;border:1px solid var(--border);border-radius:6px;margin-bottom:8px;font-size:0.9rem;" />
                        <label for="settingsBirthYear" class="settings-label">Rok narozen√≠</label>
                        <input type="number" id="settingsBirthYear" class="settings-input" placeholder="nap≈ô. 1990" min="1900" max="2030" style="width:100%;padding:8px 12px;border:1px solid var(--border);border-radius:6px;font-size:0.9rem;" />
                    </div>
                    <div class="settings-section settings-section-adult" id="settingsSectionSpeech">
                        <p class="settings-section-title">API kl√≠ƒç pro p≈ôepis ≈ôeƒçi</p>
                        <input type="password" id="settingsSpeechApiKey" class="settings-input" placeholder="Vlo≈æte kl√≠ƒç pro budouc√≠ p≈ôepis hlasov√Ωch pozn√°mek" style="width:100%;padding:8px 12px;border:1px solid var(--border);border-radius:6px;margin-bottom:4px;font-size:0.9rem;" />
                        <p class="settings-hint" style="font-size:0.75rem;color:var(--text-muted);margin:0;">Bez kl√≠ƒçe se m√≠sto p≈ôepisu vlo≈æ√≠ placeholder. Audio se v≈ædy ulo≈æ√≠ a p≈ôehraje.</p>
                    </div>
                    <div class="settings-section settings-section-adult" id="settingsSectionOpenAi">
                        <p class="settings-section-title">OpenAI API kl√≠ƒç (AI sken Knihovna + Vitus)</p>
                        <input type="password" id="settingsOpenAiKey" class="settings-input" placeholder="Vlo≈æte OpenAI kl√≠ƒç pro AI sken (ukl√°d√° se jen do localStorage)" style="width:100%;padding:8px 12px;border:1px solid var(--border);border-radius:6px;margin-bottom:6px;font-size:0.9rem;" />
                        <div style="display:flex;gap:8px;align-items:center;justify-content:space-between;">
                            <p class="settings-hint" id="settingsOpenAiKeyHint" style="font-size:0.75rem;color:var(--text-muted);margin:0;">Kl√≠ƒç nen√≠ nastaven.</p>
                            <button type="button" class="btn-modal-cancel" id="settingsOpenAiKeyClear" style="padding:6px 10px;border-radius:10px;">Smazat kl√≠ƒç</button>
                        </div>
                    </div>
                    <div class="settings-section settings-section-adult" id="settingsSectionGemini">
                        <p class="settings-section-title">Gemini API kl√≠ƒç (Google AI Studio) ‚Äì alternativa k OpenAI</p>
                        <input type="password" id="settingsGeminiKey" class="settings-input" placeholder="Vlo≈æte Gemini kl√≠ƒç (ukl√°d√° se jen do localStorage)" style="width:100%;padding:8px 12px;border:1px solid var(--border);border-radius:6px;margin-bottom:6px;font-size:0.9rem;" />
                        <div style="display:flex;gap:8px;align-items:center;justify-content:space-between;">
                            <p class="settings-hint" id="settingsGeminiKeyHint" style="font-size:0.75rem;color:var(--text-muted);margin:0;">Kl√≠ƒç nen√≠ nastaven.</p>
                            <button type="button" class="btn-modal-cancel" id="settingsGeminiKeyClear" style="padding:6px 10px;border-radius:10px;">Smazat kl√≠ƒç</button>
                        </div>
                    </div>
                    <div class="settings-section settings-section-adult">
                        <p class="settings-section-title">Rodina</p>
                        <p class="settings-family-lock-hint" id="settingsFamilyLockHint" style="display: none;"><span aria-hidden="true">üîí</span> Rodinn√© sd√≠len√≠ a Kids verze jsou dostupn√© v tarifu Family.</p>
                        <div class="settings-family-list" id="settingsFamilyList"></div>
                        <button type="button" class="btn-add-family-member-settings" id="btnAddFamilyMemberSettings">+ P≈ôidat ƒçlena rodiny</button>
                        <p class="settings-hint" id="settingsFamilyLimitHint" style="font-size:0.75rem;color:var(--text-muted);margin:8px 0 0;"></p>
                    </div>
                    <div class="settings-section family-code-section settings-section-adult">
                        <p class="settings-section-title">Rodinn√Ω k√≥d</p>
                        <p class="settings-hint" style="font-size:0.8rem;margin:0 0 8px;color:var(--text-muted);">Po≈°li tento k√≥d ƒçlen≈Øm rodiny ‚Äì po jeho zad√°n√≠ p≈ôi registraci se p≈ôipoj√≠ k tv√© knihovnƒõ.</p>
                        <button type="button" class="btn-copy-family-code" id="btnGenerateFamilyCode">Vygenerovat rodinn√Ω k√≥d</button>
                        <div class="family-code-display" id="familyCodeDisplay" style="display:none;">
                            <input type="text" id="familyCodeInput" readonly />
                            <button type="button" class="btn-copy-family-code" id="btnCopyFamilyCode">Kop√≠rovat</button>
                        </div>
                    </div>
                    <div class="settings-section settings-section-adult">
                        <p class="settings-section-title">Inventura</p>
                        <button type="button" class="btn-inventory-master" id="btnStartInventory">üîç Spustit inventuru cel√©ho bytu</button>
                    </div>
                    <div class="settings-section settings-section-adult" id="settingsPendingApprovalsSection">
                        <p class="settings-section-title">Knihy ke schv√°len√≠</p>
                        <p class="settings-hint" style="font-size:0.8rem;margin:0 0 8px;color:var(--text-muted);">Knihy p≈ôidan√© dƒõtmi ‚Äì schv√°len√© se za≈ôad√≠ do rodinn√© knihovny, zam√≠tnut√© se odstran√≠.</p>
                        <div id="settingsPendingApprovalsList"></div>
                    </div>
                    <div class="settings-section settings-danger-zone-adult settings-section-adult" id="settingsDangerZoneAdult">
                        <p class="settings-section-title">Nebezpeƒçn√° z√≥na</p>
                        <button type="button" class="btn-delete-library-settings" id="btnDeleteLibrarySettings">Smazat celou knihovnu</button>
                        <button type="button" class="btn-delete-account-settings" id="btnDeleteAccountSettings">Zru≈°it √∫ƒçet</button>
                    </div>
                </div>
                <div class="wishlist-modal-actions settings-modal-footer">
                    <button type="button" class="btn-logout-settings" id="btnLogoutSettings">Odhl√°sit se</button>
                    <button type="button" class="btn-activate-membership" id="btnSettingsActivateMembership">Aktivovat ƒçlenstv√≠</button>
                    <button type="button" class="btn-modal-submit" id="settingsModalClose" aria-label="Zav≈ô√≠t">Zav≈ô√≠t</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Mod√°l Nastaven√≠ police (p≈ôejmenovat, soukrom√≠, smazat) -->
    <div class="shelf-settings-modal-overlay" id="shelfSettingsModalOverlay" role="dialog" aria-modal="true" aria-labelledby="shelfSettingsModalTitle" style="display: none;">
        <div class="shelf-settings-modal" id="shelfSettingsModal">
            <div class="shelf-settings-modal-header">
                <h2 class="shelf-settings-modal-title" id="shelfSettingsModalTitle">Nastaven√≠ police</h2>
                <button type="button" class="shelf-settings-modal-close" id="shelfSettingsModalClose" aria-label="Zav≈ô√≠t">√ó</button>
            </div>
            <div class="shelf-settings-modal-body">
                <div class="shelf-settings-field">
                    <label for="shelfSettingsName">N√°zev police</label>
                    <input type="text" id="shelfSettingsName" placeholder="nap≈ô. Ob√Ωv√°k - horn√≠" />
                </div>
                <div class="shelf-settings-field">
                    <label for="shelfSettingsPrivacy">Filtr zobrazen√≠ (v√Ωchoz√≠)</label>
                    <select id="shelfSettingsPrivacy">
                        <option value="all">V≈°echny knihy</option>
                        <option value="private">üîí Soukrom√°</option>
                        <option value="family">üë• Rodina</option>
                        <option value="public">üåê Ve≈ôejn√°</option>
                    </select>
                </div>
                <div class="shelf-settings-actions">
                    <button type="button" class="btn-shelf-settings-rename" id="shelfSettingsRename">P≈ôejmenovat</button>
                    <button type="button" class="btn-shelf-settings-delete" id="shelfSettingsDelete">Smazat polici (knihy ‚Üí Bez poliƒçky)</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Spodn√≠ Tab Bar (mobil): Dom≈Ø, Knihovna, Vitus, Profil -->
    <nav class="bottom-tab-bar" id="bottomTabBar" aria-label="Hlavn√≠ navigace">
        <a href="./app.html" class="bottom-tab-item" data-tab="home" aria-label="Dom≈Ø">
            <span class="bottom-tab-icon"><img src="./Ikony do aplikace _ 200px/01_small200px.png" alt=""></span>
            <span class="bottom-tab-label">Dom≈Ø</span>
        </a>
        <a href="./library.html" class="bottom-tab-item" data-tab="library" aria-label="Knihovna">
            <span class="bottom-tab-icon"><img src="./Ikony do aplikace _ 200px/01_small200px_4.png" alt=""></span>
            <span class="bottom-tab-label">Knihovna</span>
        </a>
        <a href="./vitus.html" class="bottom-tab-item" data-tab="vitus" aria-label="Vitus">
            <span class="bottom-tab-icon"><img src="./Ikony do aplikace _ 200px/01_small200px_8.png" alt=""></span>
            <span class="bottom-tab-label">Vitus</span>
        </a>
        <button type="button" class="bottom-tab-item" data-tab="profile" aria-label="Profil">
            <span class="bottom-tab-icon"><img src="./Ikony do aplikace _ 200px/01_small200px_7.png" alt=""></span>
            <span class="bottom-tab-label">Profil</span>
        </button>
    </nav>
    <script>window.OMNI_CONFIG = window.OMNI_CONFIG || {};</script>
    <script src="./config.js"></script>
    <script src="./config.local.js"></script>
    <script>if (typeof window.OMNI_CONFIG === 'undefined') window.OMNI_CONFIG = {};</script>
    <script src="./src/core/keys.js"></script>
    <script src="./js/config/user-state.js"></script>
    <script>
        (function () {
            'use strict';
            try {
                // Ve≈ôejn√© sd√≠len√≠ (pokud existuje) nechceme blokovat loginem
                var qs = String(window.location.search || '');
                var isPublic = qs.indexOf('public=') >= 0 || qs.indexOf('share=') >= 0;
                if (isPublic) return;
                var u = window.OMNI_UserState && typeof window.OMNI_UserState.getCurrentUser === 'function'
                    ? window.OMNI_UserState.getCurrentUser()
                    : null;
                if (!u || u.isLoggedIn !== true) {
                    var next = '';
                    try {
                        var file = (window.location.pathname || '').split('/').pop() || 'app.html';
                        next = encodeURIComponent(file + (window.location.search || '') + (window.location.hash || ''));
                    } catch (e2) {}
                    window.location.href = './login.html' + (next ? ('?next=' + next) : '');
                }
            } catch (e) {
                window.location.href = './login.html';
            }
        })();
    </script>
    <script src="./js/config/sectors.js"></script>
    <script src="./src/core/app-state.js"></script>
    <script src="./src/core/module-switcher.js"></script>
    <script src="./src/modules/vitus/vitus-logic.js"></script>
    <script src="./src/modules/vitus/vitus-ai.js"></script>
    <script src="./src/modules/vitus/vitus-enrich.js"></script>
    <script src="./src/modules/vitus/vitus-shell.js"></script>
    <script src="./src/modules/library/text/text-module.js"></script>
    <script src="./src/modules/library/text/library-text-logic.js"></script>
    <script src="./src/modules/library/upload/upload-module.js"></script>
    <script src="./src/modules/library/upload/library-upload-logic.js"></script>
    <script src="./src/modules/library/upload/visual-map.js"></script>
    <script src="./src/modules/library/library-logic.js?v=3"></script>
    <script src="./src/modules/library/friends/friends-recommendations.js"></script>
    <script src="./src/core/navigation.js?v=3"></script>
    <script>
        (function () {
            var tabBar = document.getElementById('bottomTabBar');
            var tabItems = tabBar ? tabBar.querySelectorAll('.bottom-tab-item') : [];
            function setActiveTab(tab) {
                tabItems.forEach(function (btn) {
                    var t = btn.getAttribute('data-tab');
                    btn.classList.toggle('active', t === tab);
                });
            }
            function updateTabFromModule() {
                var mod = (window.OMNI_AppState && window.OMNI_AppState.getActiveModule) ? window.OMNI_AppState.getActiveModule() : 'library';
                if (mod === 'vitus') setActiveTab('vitus');
                else setActiveTab(mod === 'library' ? 'library' : 'home');
            }
            tabItems.forEach(function (el) {
                el.addEventListener('click', function (e) {
                    var tab = el.getAttribute('data-tab');
                    if (tab === 'profile') {
                        e.preventDefault();
                        var settingsBtn = document.getElementById('btnOpenSettings');
                        if (settingsBtn) settingsBtn.click();
                    }
                    // Dom≈Ø / Knihovna / Vitus jsou <a href="..."> ‚Äì nech√°me probƒõhnout navigaci
                });
            });
            if (window.OMNI_AppState) document.addEventListener('omni:module-changed', updateTabFromModule);
            updateTabFromModule();
        })();
    </script>
    <script>
        (function () {
            function closeMobileSidebar() {
                document.body.classList.remove('sidebar-open-mobile');
                var btn = document.getElementById('btnMobileMenuToggle');
                if (btn) btn.setAttribute('aria-expanded', 'false');
            }
            function openMobileSidebar() {
                document.body.classList.add('sidebar-open-mobile');
                var btn = document.getElementById('btnMobileMenuToggle');
                if (btn) btn.setAttribute('aria-expanded', 'true');
            }
            document.addEventListener('DOMContentLoaded', function () {
                var hamburger = document.getElementById('btnMobileMenuToggle');
                var closeBtn = document.getElementById('btnSidebarCloseMobile');
                var backdrop = document.getElementById('sidebarOverlayBackdrop');
                if (hamburger) hamburger.addEventListener('click', function () {
                    if (document.body.classList.contains('sidebar-open-mobile')) closeMobileSidebar();
                    else openMobileSidebar();
                });
                if (closeBtn) closeBtn.addEventListener('click', closeMobileSidebar);
                if (backdrop) backdrop.addEventListener('click', closeMobileSidebar);
                var sidebar = document.getElementById('sidebar-container');
                if (sidebar) {
                    sidebar.querySelectorAll('.sidebar-nav-item, .sidebar-submenu-item, .sidebar-module-btn').forEach(function (el) {
                        el.addEventListener('click', function () { closeMobileSidebar(); });
                    });
                }
            });
        })();
    </script>
    <script>
        (function () {
            function openPricingModal() {
                refreshPricingModalState();
                var conf = document.getElementById('pricingUpgradeConfirmation');
                if (conf) conf.style.display = 'none';
                var overlay = document.getElementById('pricingModalOverlay');
                if (overlay) {
                    overlay.classList.add('is-open');
                    overlay.setAttribute('aria-hidden', 'false');
                }
            }
            window.openPricingModal = openPricingModal;
            function closePricingModal() {
                var overlay = document.getElementById('pricingModalOverlay');
                if (overlay) {
                    overlay.classList.remove('is-open');
                    overlay.setAttribute('aria-hidden', 'true');
                }
            }
            function refreshPricingModalState() {
                var tier = (typeof window.OMNI_UserState !== 'undefined' && window.OMNI_UserState.getCurrentUser())
                    ? window.OMNI_UserState.getCurrentUser().tier
                    : 'free';
                var btnPro = document.getElementById('btnPricingPro');
                var btnFamily = document.getElementById('btnPricingFamily');
                if (btnPro) {
                    if (tier === 'pro') {
                        btnPro.textContent = 'V√°≈° aktu√°ln√≠ tarif';
                        btnPro.disabled = true;
                        btnPro.classList.add('pricing-cta-current');
                    } else {
                        btnPro.textContent = 'P≈ôedplatit';
                        btnPro.disabled = false;
                        btnPro.classList.remove('pricing-cta-current');
                    }
                }
                if (btnFamily) {
                    if (tier === 'family') {
                        btnFamily.textContent = 'V√°≈° aktu√°ln√≠ tarif';
                        btnFamily.disabled = true;
                        btnFamily.classList.add('pricing-cta-current');
                    } else if (tier === 'pro') {
                        btnFamily.textContent = 'P≈ôej√≠t na Family (doplatek)';
                        btnFamily.disabled = false;
                        btnFamily.classList.remove('pricing-cta-current');
                    } else {
                        btnFamily.textContent = 'P≈ôedplatit';
                        btnFamily.disabled = false;
                        btnFamily.classList.remove('pricing-cta-current');
                    }
                }
            }
            function setPricingInterval(interval) {
                var monthly = interval === 'monthly';
                document.querySelectorAll('.pricing-billing-btn').forEach(function (b) {
                    b.classList.toggle('active', (b.getAttribute('data-interval') === 'monthly') === monthly);
                });
                var suf = document.getElementById('priceProSuffix');
                var yPro = document.getElementById('priceProYear');
                var yFamily = document.getElementById('priceFamilyYear');
                var sufF = document.getElementById('priceFamilySuffix');
                if (suf) suf.style.display = monthly ? '' : 'none';
                if (yPro) yPro.style.display = monthly ? 'none' : '';
                if (sufF) sufF.style.display = monthly ? '' : 'none';
                if (yFamily) yFamily.style.display = monthly ? 'none' : '';
                var pricePro = document.getElementById('pricePro');
                var priceFamily = document.getElementById('priceFamily');
                if (pricePro) pricePro.textContent = monthly ? '149 Kƒç' : '1 430 Kƒç';
                if (priceFamily) priceFamily.textContent = monthly ? '249 Kƒç' : '2 390 Kƒç';
            }
            function doUpgrade(tier) {
                if (typeof window.OMNI_UserState === 'undefined') return;
                window.OMNI_UserState.setTier(tier);
                var conf = document.getElementById('pricingUpgradeConfirmation');
                if (conf) conf.style.display = 'block';
                refreshPricingModalState();
                if (window.OMNI_UserState.canAccessKids() && window.location.search.indexOf('mode=kids') !== -1) {
                    closePricingModal();
                    document.documentElement.classList.add('viewing-as-child');
                    document.body.classList.add('viewing-as-child');
                    document.querySelectorAll('[data-adult-only]').forEach(function (el) { el.style.display = 'none'; });
                    var btnKids = document.getElementById('btnChildrenLibraryToggle');
                    if (btnKids) btnKids.click();
                }
            }
            document.addEventListener('DOMContentLoaded', function () {
                if (window.__omniModeKids && typeof window.OMNI_UserState !== 'undefined') {
                    if (window.OMNI_UserState.canAccessKids()) {
                        document.documentElement.classList.add('viewing-as-child');
                        document.body.classList.add('viewing-as-child');
                        window.__omniWelcomeMode = 'kids';
                        document.querySelectorAll('[data-adult-only]').forEach(function (el) { el.style.display = 'none'; });
                        var btn = document.getElementById('btnChildrenLibraryToggle');
                        if (btn) setTimeout(function () { btn.click(); }, 0);
                    } else {
                        openPricingModal();
                    }
                    window.__omniModeKids = false;
                }
                var overlay = document.getElementById('pricingModalOverlay');
                var closeBtn = document.getElementById('pricingModalClose');
                if (overlay) overlay.addEventListener('click', function (e) { if (e.target === overlay) closePricingModal(); });
                if (closeBtn) closeBtn.addEventListener('click', closePricingModal);
                document.getElementById('pricingBillingMonthly') && document.getElementById('pricingBillingMonthly').addEventListener('click', function () { setPricingInterval('monthly'); });
                document.getElementById('pricingBillingYearly') && document.getElementById('pricingBillingYearly').addEventListener('click', function () { setPricingInterval('yearly'); });
                var btnPro = document.getElementById('btnPricingPro');
                var btnFamily = document.getElementById('btnPricingFamily');
                if (btnPro) btnPro.addEventListener('click', function () {
                    if (typeof window.OMNI_UserState !== 'undefined' && window.OMNI_UserState.getCurrentUser().tier !== 'pro') doUpgrade('pro');
                });
                if (btnFamily) btnFamily.addEventListener('click', function () {
                    if (typeof window.OMNI_UserState !== 'undefined' && window.OMNI_UserState.getCurrentUser().tier !== 'family') doUpgrade('family');
                });
                var btnKids = document.getElementById('btnChildrenLibraryToggle');
                if (btnKids && typeof window.OMNI_UserState !== 'undefined') {
                    btnKids.addEventListener('click', function (e) {
                        if (!window.OMNI_UserState.canAccessKids()) {
                            e.preventDefault();
                            e.stopImmediatePropagation();
                            openPricingModal();
                        }
                    }, true);
                }
            });
        })();
        (function () {
            function initLibraryModuleTabs() {
                var wrap = document.getElementById('libraryModulesWrap');
                if (!wrap) return;
                var tabs = wrap.querySelectorAll('.library-module-tab');
                var panels = wrap.querySelectorAll('.library-module');
                tabs.forEach(function (tab) {
                    tab.addEventListener('click', function () {
                        try { if (typeof window.__OMNI_closeUploadTipsModal === 'function') window.__OMNI_closeUploadTipsModal(); } catch (eClose) {}
                        var mod = tab.getAttribute('data-library-module');
                        var targetId = mod === 'texty' ? 'libraryModuleTexty' : 'libraryModuleUpload';
                        // UX: klik na jaz√Ωƒçek otev≈ôe panel (jinak to vypad√°, ≈æe se "nic nedƒõje")
                        try {
                            if (typeof window.__OMNI_setLibraryModulesOpen === 'function') window.__OMNI_setLibraryModulesOpen(true);
                        } catch (e0) {}
                        tabs.forEach(function (t) {
                            t.classList.toggle('active', t === tab);
                            t.setAttribute('aria-selected', t === tab ? 'true' : 'false');
                        });
                        panels.forEach(function (panel) {
                            var show = panel.id === targetId;
                            panel.hidden = !show;
                        });
                    });
                });
            }
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initLibraryModuleTabs);
            } else {
                initLibraryModuleTabs();
            }
        })();
        (function () {
            document.addEventListener('DOMContentLoaded', function () {
                var btnLogout = document.getElementById('btnLogoutSettings');
                if (btnLogout) {
                    btnLogout.addEventListener('click', function () {
                        localStorage.removeItem('omnishelf_user_state');
                        localStorage.removeItem('omnishelf_current_user');
                        localStorage.removeItem('omnishelf_current_user_role');
                        localStorage.removeItem('omnishelf_current_user_name');
                        try { if (typeof window.OMNI_UserState !== 'undefined' && window.OMNI_UserState.setLoggedIn) window.OMNI_UserState.setLoggedIn(false); } catch (e0) {}
                        try { if (typeof window.OMNI_UserState !== 'undefined' && window.OMNI_UserState.leaveFamily) window.OMNI_UserState.leaveFamily(); } catch (e1) {}
                        location.href = 'index.html';
                    });
                }
                var btnActivate = document.getElementById('btnSettingsActivateMembership');
                var settingsOverlay = document.getElementById('settingsModalOverlay');
                if (btnActivate && settingsOverlay) {
                    btnActivate.addEventListener('click', function () {
                        settingsOverlay.style.display = 'none';
                        if (typeof window.openPricingModal === 'function') window.openPricingModal();
                    });
                }
            });
        })();

        // UI: Glob√°ln√≠ sbaliteln√Ω panel (Texty + Upload) + tipy v upload z√≥nƒõ
        (function () {
            function applyOpen(isOpen) {
                var wrap = document.getElementById('libraryModulesPanelsWrap');
                var statusText = document.getElementById('libraryModulesStatusText');
                var btnOpen = document.getElementById('btnOpenLibraryModules');
                var btnClose = document.getElementById('btnCloseLibraryModules');
                if (!wrap || !statusText || !btnOpen || !btnClose) return;
                wrap.hidden = !isOpen;
                statusText.textContent = isOpen ? 'Panel nahr√°v√°n√≠ je otev≈ôen' : 'Panel nahr√°v√°n√≠ je zav≈ôen√Ω';
                btnOpen.style.display = isOpen ? 'none' : '';
                btnClose.hidden = !isOpen;
            }

            function openTipsModal() {
                var overlay = document.getElementById('uploadTipsModalOverlay');
                if (!overlay) return;
                overlay.hidden = false;
            }

            function closeTipsModal() {
                var overlay = document.getElementById('uploadTipsModalOverlay');
                if (!overlay) return;
                overlay.hidden = true;
            }

            document.addEventListener('DOMContentLoaded', function () {
                // default: zav≈ôeno
                applyOpen(false);
                closeTipsModal();
                // expose for tab handler
                window.__OMNI_setLibraryModulesOpen = applyOpen;
                window.__OMNI_closeUploadTipsModal = closeTipsModal;

                var btnOpen = document.getElementById('btnOpenLibraryModules');
                var btnClose = document.getElementById('btnCloseLibraryModules');
                if (btnOpen) btnOpen.addEventListener('click', function () {
                    applyOpen(true);
                    var wrap = document.getElementById('libraryModulesWrap');
                    if (wrap) wrap.scrollIntoView({ behavior: 'smooth', block: 'start' });
                });
                if (btnClose) btnClose.addEventListener('click', function () {
                    closeTipsModal();
                    applyOpen(false);
                });

                // P≈ôi p≈ôepnut√≠ sekce knihovny (P≈Øjƒçovna/Wishlist/Prodej/...) standardnƒõ zabal
                document.addEventListener('library-view-changed', function () {
                    closeTipsModal();
                    applyOpen(false);
                });

                // Tipy: tlaƒç√≠tko je uvnit≈ô drop z√≥ny ‚Äì nesm√≠ spou≈°tƒõt v√Ωbƒõr souboru
                document.querySelectorAll('[data-open-tips="1"]').forEach(function (btn) {
                    btn.addEventListener('click', function (e) {
                        e.preventDefault();
                        e.stopPropagation();
                        openTipsModal();
                    });
                });

                var overlay = document.getElementById('uploadTipsModalOverlay');
                var closeBtn = document.getElementById('uploadTipsModalClose');
                if (overlay) {
                    overlay.addEventListener('click', function (e) {
                        if (e.target === overlay) closeTipsModal();
                    });
                }
                if (closeBtn) closeBtn.addEventListener('click', function () { closeTipsModal(); });
                document.addEventListener('keydown', function (e) {
                    if (e.key === 'Escape') closeTipsModal();
                });
            });
        })();
    </script>
    <script>
        (function () {
            if (!('serviceWorker' in navigator)) return;
            window.addEventListener('load', function () {
                navigator.serviceWorker.register('./service-worker.js', { scope: './' }).then(function (reg) {
                    if (reg.updated) console.log('OmniShelf: SW updated');
                }).catch(function (err) {
                    console.warn('OmniShelf: SW registration failed', err);
                });
            });
        })();
    </script>
</body>
</html>
